{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/slugify/index.js","webpack:///./assets/js/shutterpress-image.js","webpack:///./assets/js/shutterpress-images.js","webpack:///./assets/js/shutterpress-toolbar.js","webpack:///./assets/js/filters/shutterpress-search.js","webpack:///./assets/js/shutterpress-details.js","webpack:///./assets/js/shutterpress-sidebar.js","webpack:///./assets/js/shutterpress-empty.js","webpack:///./assets/js/filters/shutterpress-checkbox-filter.js","webpack:///./assets/js/filters/shutterpress-gender.js","webpack:///./assets/js/models/shutterpress-image-model.js","webpack:///./assets/js/shutterpress-downloader.js","webpack:///./assets/js/filters/shutterpress-advanced-trigger.js","webpack:///./assets/js/filters/shutterpress-advanced-filters.js","webpack:///./assets/js/filters/shutterpress-advanced.js","webpack:///./assets/js/filters/shutterpress-filter-button.js","webpack:///./assets/js/filters/shutterpress-orientations.js","webpack:///./assets/js/filters/shutterpress-image-type.js","webpack:///./assets/js/filters/shutterpress-select-filter.js","webpack:///./assets/js/filters/shutterpress-category.js","webpack:///./assets/js/models/shutterpress-images-model.js","webpack:///./assets/js/filters/shutterpress-safe.js","webpack:///./assets/js/filters/shutterpress-radio-filter.js","webpack:///./assets/js/filters/shutterpress-color.js","webpack:///./assets/js/filters/shutterpress-color-picker-filter.js","webpack:///./assets/js/filters/shutterpress-filter-close.js","webpack:///./assets/js/shutterpress-browser.js","webpack:///./assets/js/models/shutterpress-selection-model.js","webpack:///./assets/js/shutterpress-helpers.js","webpack:///./assets/js/shutterpress.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","factory","charMap","JSON","parse","replace","string","options","Error","replacement","slug","split","reduce","result","ch","remove","trim","lower","toLowerCase","extend","customMap","ShutterpressImage","wp","media","View","tagName","className","template","events","click","keydown","click .check","click .download","buttons","check","initialize","selection","this","_","defaults","rerenderOnModelChange","listenTo","model","render","select","deselect","on","updateSelect","details","controller","state","dispose","off","apply","arguments","toJSON","orientation","type","subtype","width","height","description","size","imageSize","views","detach","$el","html","toggleSelectionHandler","event","method","target","nodeName","keyCode","preventDefault","isModeActive","trigger","currentTarget","shiftKey","ctrlKey","metaKey","toggleSelection","single","models","singleIndex","modelIndex","collection","isUndefined","multiple","indexOf","slice","add","selected","cid","hasClass","addClass","attr","$","removeClass","find","toggleClass","sizes","matched","large","thumbnail","full","clone","url","checkClickHandler","stopPropagation","where","id","length","focus","downloadClickHandler","ShutterpressImages","attributes","tabIndex","el","uniqueId","sortable","refreshSensitivity","isTouchDevice","refreshThreshold","resize","idealColumnWidth","window","_viewsByCid","$window","resizeEvent","attachment","createAttachmentView","at","view","scroll","chain","throttle","scrollElement","bindAll","bindEvents","setColumns","defer","debounce","prepare","set","map","unset","more","toolbar","scrollTop","document","body","is","hasMore","parent","scrollHeight","clientHeight","show","done","hide","prev","columns","Math","min","round","closest","ShutterpressToolbar","library","_views","primary","PriorityList","secondary","items","silent","refresh","ready","isObject","each","Backbone","classes","concat","Button","priority","button","requires","disabled","some","ShutterpressSearch","placeholder","l10n","shutterpress","search","input","keyup","escape","ShutterpressDetails","data-id","initialFocus","eq","ShutterpressSidebar","index","toView","existing","isNumber","ShutterpressEmpty","click .retry","message","link","retry","Model","def","browser","updateContent","ShutterpressCheckboxFilters","keys","checked","createFilters","createChecked","filters","$mainLabel","text","label","class","filter","e","checkboxChange","$label","for","append","sortBy","pluck","prepend","wrap","updateFilters","getValue","default","$element","val","push","ShutterpressGenderFilters","female","gender","props","people_gender","male","ShutterpressImageModel","sync","Deferred","rejectWith","promise","context","data","action","ajax","update","nonce","post_id","settings","post","hasChanged","changes","changed","progress","$bar","attrs","all","memoize","ShutterpressDownloader","file","_this","uploading","Attachment","ShutterpressQueue","reset","downloadTrigger","click .download-shutterpress-image","download","addFileToQueue","openMediaTab","content","item","date","Date","menuOrder","filename","uploadedTo","shutterpressId","getFile","media_id","response","fail","downloadFile","loading","setInterval","incrementPercent","clearInterval","error","percent","destroy","Uploader","errors","unshift","pluploadL10n","default_error","ShutterpressAdvancedLink","uniq","join","toggleAdvanced","ShutterpressAdvancedFilters","actions","ShutterpressAdvanced","ShutterpressFilterButton","triggerFilter","ShutterpressOrientationFilters","horizontal","vertical","ShutterpressImageFilters","photo","image_type","vector","illustration","ShutterpressSelectFilters","$select","change","queries","slugify","require","ShutterpressCategoryFilters","categories","category","values","_arr","entries","_i","_arr$_i","_slicedToArray","ShutterpressSafeFilters","radioChange","yes","safe","no","ShutterpressColorFilter","wpColorPicker","color","ShutterpressFilterClose","closeAdvanced","ShutterpressBrowser","createToolbar","createSidebar","createStatus","createImages","images","sidebar","createSingle","disposeSingle","noItemsView","status","stopLoading","startLoading","clearErrors","dfd","displayError","toolbarOptions","advancedFilters","Spinner","addToolbarFilters","Label","advanced","filtersContainer","ImageTypeFilter","ShutterpressImageTypeFilter","CategoryFilter","GenderFilters","ShutterpressGenderFilter","SafeFilter","OrientationFilter","ShutterpressOrientationFilter","ColorFilter","statusOptions","noMedia","code","ShutterpressImagesModel","Collection","_changeFilteredProps","_changeQuery","mirror","attachments","mirroring","unmirror","observe","unobserve","query","_requery","prop","term","any","_source","validator","cache","ShutterpressQuery","deferred","jQuery","resolveWith","validateDestroyed","destroyed","validate","valid","hasAttachment","validateAll","observers","_validateHandler","_validateAllHandler","without","args","_hasMore","created","_more","fetch","resp","isEmpty","per_page","page","ShutterPressImagesModel","defaultArgs","defaultProps","propmap","perPage","isArray","isNull","isEqual","ShutterpressSelection","previous","_single","last","getShutterPressQuery","orderby","Library","oldMediaFrame","MediaFrame","Post","oldMediaFrameSelect","Select","ShutterpressQueueErrors","browseRouter","routerView","title","bindHandlers","shutterpressContent","contentRegion","omit","suggestedWidth","suggestedHeight","getFrame","states","findWhere"],"mappings":"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","file":"/dist/js/shutterpress.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","\n;(function (name, root, factory) {\n  if (typeof exports === 'object') {\n    module.exports = factory()\n    module.exports['default'] = factory()\n  }\n  /* istanbul ignore next */\n  else if (typeof define === 'function' && define.amd) {\n    define(factory)\n  }\n  else {\n    root[name] = factory()\n  }\n}('slugify', this, function () {\n  /* eslint-disable */\n  var charMap = JSON.parse('{\"$\":\"dollar\",\"%\":\"percent\",\"&\":\"and\",\"<\":\"less\",\">\":\"greater\",\"|\":\"or\",\"¢\":\"cent\",\"£\":\"pound\",\"¤\":\"currency\",\"¥\":\"yen\",\"©\":\"(c)\",\"ª\":\"a\",\"®\":\"(r)\",\"º\":\"o\",\"À\":\"A\",\"Á\":\"A\",\"Â\":\"A\",\"Ã\":\"A\",\"Ä\":\"A\",\"Å\":\"A\",\"Æ\":\"AE\",\"Ç\":\"C\",\"È\":\"E\",\"É\":\"E\",\"Ê\":\"E\",\"Ë\":\"E\",\"Ì\":\"I\",\"Í\":\"I\",\"Î\":\"I\",\"Ï\":\"I\",\"Ð\":\"D\",\"Ñ\":\"N\",\"Ò\":\"O\",\"Ó\":\"O\",\"Ô\":\"O\",\"Õ\":\"O\",\"Ö\":\"O\",\"Ø\":\"O\",\"Ù\":\"U\",\"Ú\":\"U\",\"Û\":\"U\",\"Ü\":\"U\",\"Ý\":\"Y\",\"Þ\":\"TH\",\"ß\":\"ss\",\"à\":\"a\",\"á\":\"a\",\"â\":\"a\",\"ã\":\"a\",\"ä\":\"a\",\"å\":\"a\",\"æ\":\"ae\",\"ç\":\"c\",\"è\":\"e\",\"é\":\"e\",\"ê\":\"e\",\"ë\":\"e\",\"ì\":\"i\",\"í\":\"i\",\"î\":\"i\",\"ï\":\"i\",\"ð\":\"d\",\"ñ\":\"n\",\"ò\":\"o\",\"ó\":\"o\",\"ô\":\"o\",\"õ\":\"o\",\"ö\":\"o\",\"ø\":\"o\",\"ù\":\"u\",\"ú\":\"u\",\"û\":\"u\",\"ü\":\"u\",\"ý\":\"y\",\"þ\":\"th\",\"ÿ\":\"y\",\"Ā\":\"A\",\"ā\":\"a\",\"Ă\":\"A\",\"ă\":\"a\",\"Ą\":\"A\",\"ą\":\"a\",\"Ć\":\"C\",\"ć\":\"c\",\"Č\":\"C\",\"č\":\"c\",\"Ď\":\"D\",\"ď\":\"d\",\"Đ\":\"DJ\",\"đ\":\"dj\",\"Ē\":\"E\",\"ē\":\"e\",\"Ė\":\"E\",\"ė\":\"e\",\"Ę\":\"e\",\"ę\":\"e\",\"Ě\":\"E\",\"ě\":\"e\",\"Ğ\":\"G\",\"ğ\":\"g\",\"Ģ\":\"G\",\"ģ\":\"g\",\"Ĩ\":\"I\",\"ĩ\":\"i\",\"Ī\":\"i\",\"ī\":\"i\",\"Į\":\"I\",\"į\":\"i\",\"İ\":\"I\",\"ı\":\"i\",\"Ķ\":\"k\",\"ķ\":\"k\",\"Ļ\":\"L\",\"ļ\":\"l\",\"Ľ\":\"L\",\"ľ\":\"l\",\"Ł\":\"L\",\"ł\":\"l\",\"Ń\":\"N\",\"ń\":\"n\",\"Ņ\":\"N\",\"ņ\":\"n\",\"Ň\":\"N\",\"ň\":\"n\",\"Ő\":\"O\",\"ő\":\"o\",\"Œ\":\"OE\",\"œ\":\"oe\",\"Ŕ\":\"R\",\"ŕ\":\"r\",\"Ř\":\"R\",\"ř\":\"r\",\"Ś\":\"S\",\"ś\":\"s\",\"Ş\":\"S\",\"ş\":\"s\",\"Š\":\"S\",\"š\":\"s\",\"Ţ\":\"T\",\"ţ\":\"t\",\"Ť\":\"T\",\"ť\":\"t\",\"Ũ\":\"U\",\"ũ\":\"u\",\"Ū\":\"u\",\"ū\":\"u\",\"Ů\":\"U\",\"ů\":\"u\",\"Ű\":\"U\",\"ű\":\"u\",\"Ų\":\"U\",\"ų\":\"u\",\"Ź\":\"Z\",\"ź\":\"z\",\"Ż\":\"Z\",\"ż\":\"z\",\"Ž\":\"Z\",\"ž\":\"z\",\"ƒ\":\"f\",\"Ơ\":\"O\",\"ơ\":\"o\",\"Ư\":\"U\",\"ư\":\"u\",\"ǈ\":\"LJ\",\"ǉ\":\"lj\",\"ǋ\":\"NJ\",\"ǌ\":\"nj\",\"Ș\":\"S\",\"ș\":\"s\",\"Ț\":\"T\",\"ț\":\"t\",\"˚\":\"o\",\"Ά\":\"A\",\"Έ\":\"E\",\"Ή\":\"H\",\"Ί\":\"I\",\"Ό\":\"O\",\"Ύ\":\"Y\",\"Ώ\":\"W\",\"ΐ\":\"i\",\"Α\":\"A\",\"Β\":\"B\",\"Γ\":\"G\",\"Δ\":\"D\",\"Ε\":\"E\",\"Ζ\":\"Z\",\"Η\":\"H\",\"Θ\":\"8\",\"Ι\":\"I\",\"Κ\":\"K\",\"Λ\":\"L\",\"Μ\":\"M\",\"Ν\":\"N\",\"Ξ\":\"3\",\"Ο\":\"O\",\"Π\":\"P\",\"Ρ\":\"R\",\"Σ\":\"S\",\"Τ\":\"T\",\"Υ\":\"Y\",\"Φ\":\"F\",\"Χ\":\"X\",\"Ψ\":\"PS\",\"Ω\":\"W\",\"Ϊ\":\"I\",\"Ϋ\":\"Y\",\"ά\":\"a\",\"έ\":\"e\",\"ή\":\"h\",\"ί\":\"i\",\"ΰ\":\"y\",\"α\":\"a\",\"β\":\"b\",\"γ\":\"g\",\"δ\":\"d\",\"ε\":\"e\",\"ζ\":\"z\",\"η\":\"h\",\"θ\":\"8\",\"ι\":\"i\",\"κ\":\"k\",\"λ\":\"l\",\"μ\":\"m\",\"ν\":\"n\",\"ξ\":\"3\",\"ο\":\"o\",\"π\":\"p\",\"ρ\":\"r\",\"ς\":\"s\",\"σ\":\"s\",\"τ\":\"t\",\"υ\":\"y\",\"φ\":\"f\",\"χ\":\"x\",\"ψ\":\"ps\",\"ω\":\"w\",\"ϊ\":\"i\",\"ϋ\":\"y\",\"ό\":\"o\",\"ύ\":\"y\",\"ώ\":\"w\",\"Ё\":\"Yo\",\"Ђ\":\"DJ\",\"Є\":\"Ye\",\"І\":\"I\",\"Ї\":\"Yi\",\"Ј\":\"J\",\"Љ\":\"LJ\",\"Њ\":\"NJ\",\"Ћ\":\"C\",\"Џ\":\"DZ\",\"А\":\"A\",\"Б\":\"B\",\"В\":\"V\",\"Г\":\"G\",\"Д\":\"D\",\"Е\":\"E\",\"Ж\":\"Zh\",\"З\":\"Z\",\"И\":\"I\",\"Й\":\"J\",\"К\":\"K\",\"Л\":\"L\",\"М\":\"M\",\"Н\":\"N\",\"О\":\"O\",\"П\":\"P\",\"Р\":\"R\",\"С\":\"S\",\"Т\":\"T\",\"У\":\"U\",\"Ф\":\"F\",\"Х\":\"H\",\"Ц\":\"C\",\"Ч\":\"Ch\",\"Ш\":\"Sh\",\"Щ\":\"Sh\",\"Ъ\":\"U\",\"Ы\":\"Y\",\"Ь\":\"\",\"Э\":\"E\",\"Ю\":\"Yu\",\"Я\":\"Ya\",\"а\":\"a\",\"б\":\"b\",\"в\":\"v\",\"г\":\"g\",\"д\":\"d\",\"е\":\"e\",\"ж\":\"zh\",\"з\":\"z\",\"и\":\"i\",\"й\":\"j\",\"к\":\"k\",\"л\":\"l\",\"м\":\"m\",\"н\":\"n\",\"о\":\"o\",\"п\":\"p\",\"р\":\"r\",\"с\":\"s\",\"т\":\"t\",\"у\":\"u\",\"ф\":\"f\",\"х\":\"h\",\"ц\":\"c\",\"ч\":\"ch\",\"ш\":\"sh\",\"щ\":\"sh\",\"ъ\":\"u\",\"ы\":\"y\",\"ь\":\"\",\"э\":\"e\",\"ю\":\"yu\",\"я\":\"ya\",\"ё\":\"yo\",\"ђ\":\"dj\",\"є\":\"ye\",\"і\":\"i\",\"ї\":\"yi\",\"ј\":\"j\",\"љ\":\"lj\",\"њ\":\"nj\",\"ћ\":\"c\",\"џ\":\"dz\",\"Ґ\":\"G\",\"ґ\":\"g\",\"฿\":\"baht\",\"ა\":\"a\",\"ბ\":\"b\",\"გ\":\"g\",\"დ\":\"d\",\"ე\":\"e\",\"ვ\":\"v\",\"ზ\":\"z\",\"თ\":\"t\",\"ი\":\"i\",\"კ\":\"k\",\"ლ\":\"l\",\"მ\":\"m\",\"ნ\":\"n\",\"ო\":\"o\",\"პ\":\"p\",\"ჟ\":\"zh\",\"რ\":\"r\",\"ს\":\"s\",\"ტ\":\"t\",\"უ\":\"u\",\"ფ\":\"f\",\"ქ\":\"k\",\"ღ\":\"gh\",\"ყ\":\"q\",\"შ\":\"sh\",\"ჩ\":\"ch\",\"ც\":\"ts\",\"ძ\":\"dz\",\"წ\":\"ts\",\"ჭ\":\"ch\",\"ხ\":\"kh\",\"ჯ\":\"j\",\"ჰ\":\"h\",\"ẞ\":\"SS\",\"Ạ\":\"A\",\"ạ\":\"a\",\"Ả\":\"A\",\"ả\":\"a\",\"Ấ\":\"A\",\"ấ\":\"a\",\"Ầ\":\"A\",\"ầ\":\"a\",\"Ẩ\":\"A\",\"ẩ\":\"a\",\"Ẫ\":\"A\",\"ẫ\":\"a\",\"Ậ\":\"A\",\"ậ\":\"a\",\"Ắ\":\"A\",\"ắ\":\"a\",\"Ằ\":\"A\",\"ằ\":\"a\",\"Ẳ\":\"A\",\"ẳ\":\"a\",\"Ẵ\":\"A\",\"ẵ\":\"a\",\"Ặ\":\"A\",\"ặ\":\"a\",\"Ẹ\":\"E\",\"ẹ\":\"e\",\"Ẻ\":\"E\",\"ẻ\":\"e\",\"Ẽ\":\"E\",\"ẽ\":\"e\",\"Ế\":\"E\",\"ế\":\"e\",\"Ề\":\"E\",\"ề\":\"e\",\"Ể\":\"E\",\"ể\":\"e\",\"Ễ\":\"E\",\"ễ\":\"e\",\"Ệ\":\"E\",\"ệ\":\"e\",\"Ỉ\":\"I\",\"ỉ\":\"i\",\"Ị\":\"I\",\"ị\":\"i\",\"Ọ\":\"O\",\"ọ\":\"o\",\"Ỏ\":\"O\",\"ỏ\":\"o\",\"Ố\":\"O\",\"ố\":\"o\",\"Ồ\":\"O\",\"ồ\":\"o\",\"Ổ\":\"O\",\"ổ\":\"o\",\"Ỗ\":\"O\",\"ỗ\":\"o\",\"Ộ\":\"O\",\"ộ\":\"o\",\"Ớ\":\"O\",\"ớ\":\"o\",\"Ờ\":\"O\",\"ờ\":\"o\",\"Ở\":\"O\",\"ở\":\"o\",\"Ỡ\":\"O\",\"ỡ\":\"o\",\"Ợ\":\"O\",\"ợ\":\"o\",\"Ụ\":\"U\",\"ụ\":\"u\",\"Ủ\":\"U\",\"ủ\":\"u\",\"Ứ\":\"U\",\"ứ\":\"u\",\"Ừ\":\"U\",\"ừ\":\"u\",\"Ử\":\"U\",\"ử\":\"u\",\"Ữ\":\"U\",\"ữ\":\"u\",\"Ự\":\"U\",\"ự\":\"u\",\"Ỳ\":\"Y\",\"ỳ\":\"y\",\"Ỵ\":\"Y\",\"ỵ\":\"y\",\"Ỷ\":\"Y\",\"ỷ\":\"y\",\"Ỹ\":\"Y\",\"ỹ\":\"y\",\"‘\":\"\\'\",\"’\":\"\\'\",\"“\":\"\\\\\\\"\",\"”\":\"\\\\\\\"\",\"†\":\"+\",\"•\":\"*\",\"…\":\"...\",\"₠\":\"ecu\",\"₢\":\"cruzeiro\",\"₣\":\"french franc\",\"₤\":\"lira\",\"₥\":\"mill\",\"₦\":\"naira\",\"₧\":\"peseta\",\"₨\":\"rupee\",\"₩\":\"won\",\"₪\":\"new shequel\",\"₫\":\"dong\",\"€\":\"euro\",\"₭\":\"kip\",\"₮\":\"tugrik\",\"₯\":\"drachma\",\"₰\":\"penny\",\"₱\":\"peso\",\"₲\":\"guarani\",\"₳\":\"austral\",\"₴\":\"hryvnia\",\"₵\":\"cedi\",\"₹\":\"indian rupee\",\"₽\":\"russian ruble\",\"₿\":\"bitcoin\",\"℠\":\"sm\",\"™\":\"tm\",\"∂\":\"d\",\"∆\":\"delta\",\"∑\":\"sum\",\"∞\":\"infinity\",\"♥\":\"love\",\"元\":\"yuan\",\"円\":\"yen\",\"﷼\":\"rial\"}')\n  /* eslint-enable */\n\n  function replace (string, options) {\n    if (typeof string !== 'string') {\n      throw new Error('slugify: string argument expected')\n    }\n\n    options = (typeof options === 'string')\n      ? {replacement: options}\n      : options || {}\n\n    var slug = string.split('')\n      .reduce(function (result, ch) {\n        return result + (charMap[ch] || ch)\n          // allowed\n          .replace(options.remove || /[^\\w\\s$*_+~.()'\"!\\-:@]/g, '')\n      }, '')\n      // trim leading/trailing spaces\n      .trim()\n      // convert spaces\n      .replace(/[-\\s]+/g, options.replacement || '-')\n\n    return options.lower ? slug.toLowerCase() : slug\n  }\n\n  replace.extend = function (customMap) {\n    for (var key in customMap) {\n      charMap[key] = customMap[key]\n    }\n  }\n\n  return replace\n}))\n","var ShutterpressImage = wp.media.View.extend({\n    tagName: 'li',\n    className: 'attachment',\n    template: wp.template('shutterpress-attachment'),\n    events: {\n        'click': 'toggleSelectionHandler',\n        'keydown': 'toggleSelectionHandler',\n        'click .check': 'checkClickHandler',\n        'click .download': 'downloadClickHandler',\n    },\n    buttons: {\n        check: true\n    },\n\n    initialize: function () {\n        var selection = this.options.selection,\n            options = _.defaults(this.options, {\n                rerenderOnModelChange: true\n            });\n\n        this.listenTo(this.model, 'change', this.render);\n\n        // Update the selection.\n        this.listenTo(this.model, 'add', this.select);\n        this.listenTo(this.model, 'remove', this.deselect);\n        if (selection) {\n            selection.on('reset', this.updateSelect, this);\n            // Update the model's details view.\n            this.listenTo(this.model, 'selection:single selection:unsingle', this.details);\n            this.details(this.model, this.controller.state().get('selection'));\n        }\n\n\n    },\n\n    /**\n     * @returns {ShutterpressImage} Returns itself to allow chaining\n     */\n    dispose: function () {\n        var selection = this.options.selection;\n\n        if (selection) {\n            selection.off(null, null, this);\n        }\n        /**\n         * call 'dispose' directly on the parent class\n         */\n        wp.media.View.prototype.dispose.apply(this, arguments);\n        return this;\n    },\n    /**\n     * @returns {ShutterpressImage} Returns itself to allow chaining\n     */\n    render: function () {\n        var options = _.defaults(this.model.toJSON(), {\n            orientation: 'landscape',\n            type: 'image',\n            subtype: '',\n            width: '',\n            height: '',\n            description: ''\n        }, this.options);\n\n        options.buttons = this.buttons;\n\n        if ('image' === options.type) {\n            options.size = this.imageSize();\n        }\n\n        this.views.detach();\n        this.$el.html(this.template(options));\n\n        // Check if the model is selected.\n        this.updateSelect();\n\n        this.views.render();\n\n        return this;\n    },\n\n    /**\n     * @param {Object} event\n     */\n    toggleSelectionHandler: function (event) {\n        var method;\n\n        // Don't do anything inside inputs and on the attachment check and remove buttons.\n        if ('INPUT' === event.target.nodeName || 'BUTTON' === event.target.nodeName) {\n            return;\n        }\n\n        // Catch arrow events\n        if (37 === event.keyCode || 38 === event.keyCode || 39 === event.keyCode || 40 === event.keyCode) {\n            this.controller.trigger('attachment:keydown:arrow', event);\n            return;\n        }\n\n        // Catch enter and space events\n        if ('keydown' === event.type && 13 !== event.keyCode && 32 !== event.keyCode) {\n            return;\n        }\n\n        event.preventDefault();\n\n        // In the grid view, bubble up an edit:attachment event to the controller.\n        if (this.controller.isModeActive('grid')) {\n            if (this.controller.isModeActive('edit')) {\n                // Pass the current target to restore focus when closing\n                this.controller.trigger('edit:attachment', this.model, event.currentTarget);\n                return;\n            }\n\n            if (this.controller.isModeActive('select')) {\n                method = 'toggle';\n            }\n        }\n\n        if (event.shiftKey) {\n            method = 'between';\n        } else if (event.ctrlKey || event.metaKey) {\n            method = 'toggle';\n        }\n\n        this.toggleSelection({\n            method: method\n        });\n\n        this.controller.trigger('selection:toggle');\n    },\n    /**\n     * @param {Object} options\n     */\n    toggleSelection: function (options) {\n        var collection = this.collection,\n            selection = this.options.selection,\n            model = this.model,\n            method = options && options.method,\n            single, models, singleIndex, modelIndex;\n\n        if (!selection) {\n            return;\n        }\n\n        single = selection.single();\n        method = _.isUndefined(method) ? selection.multiple : method;\n\n        // If the `method` is set to `between`, select all models that\n        // exist between the current and the selected model.\n        if ('between' === method && single && selection.multiple) {\n            // If the models are the same, short-circuit.\n            if (single === model) {\n                return;\n            }\n\n            singleIndex = collection.indexOf(single);\n            modelIndex = collection.indexOf(this.model);\n\n            if (singleIndex < modelIndex) {\n                models = collection.models.slice(singleIndex, modelIndex + 1);\n            } else {\n                models = collection.models.slice(modelIndex, singleIndex + 1);\n            }\n\n            selection.add(models);\n            selection.single(model);\n            return;\n\n            // If the `method` is set to `toggle`, just flip the selection\n            // status, regardless of whether the model is the single model.\n        } else if ('toggle' === method) {\n            selection[this.selected() ? 'remove' : 'add'](model);\n            selection.single(model);\n            return;\n        } else if ('add' === method) {\n            selection.add(model);\n            selection.single(model);\n            return;\n        }\n\n        // Fixes bug that loses focus when selecting a featured image\n        if (!method) {\n            method = 'add';\n        }\n\n        if (method !== 'add') {\n            method = 'reset';\n        }\n\n        if (this.selected()) {\n            // If the model is the single model, remove it.\n            // If it is not the same as the single model,\n            // it now becomes the single model.\n            selection[single === model ? 'remove' : 'single'](model);\n        } else {\n            // If the model is not selected, run the `method` on the\n            // selection. By default, we `reset` the selection, but the\n            // `method` can be set to `add` the model to the selection.\n            selection[method](model);\n            selection.single(model);\n        }\n    },\n\n    updateSelect: function () {\n        this[this.selected() ? 'select' : 'deselect']();\n    },\n    /**\n     * @returns {unresolved|Boolean}\n     */\n    selected: function () {\n        var selection = this.options.selection;\n        if (selection) {\n            return !!selection.get(this.model.cid);\n        }\n    },\n    /**\n     * @param {Backbone.Model} model\n     * @param {Backbone.Collection} collection\n     */\n    select: function (model, collection) {\n        var selection = this.options.selection,\n            controller = this.controller;\n\n        // Check if a selection exists and if it's the collection provided.\n        // If they're not the same collection, bail; we're in another\n        // selection's event loop.\n        if (!selection || (collection && collection !== selection)) {\n            return;\n        }\n\n        // Bail if the model is already selected.\n        if (this.$el.hasClass('selected')) {\n            // call download function\n            return;\n        }\n\n        // Add 'selected' class to model, set aria-checked to true.\n        this.$el.addClass('selected').attr('aria-checked', true);\n        //  Make the checkbox tabable, except in media grid (bulk select mode).\n        if (!(controller.isModeActive('grid') && controller.isModeActive('select'))) {\n            this.$('.check').attr('tabindex', '0');\n        }\n    },\n    /**\n     * @param {Backbone.Model} model\n     * @param {Backbone.Collection} collection\n     */\n    deselect: function (model, collection) {\n        var selection = this.options.selection;\n\n        // Check if a selection exists and if it's the collection provided.\n        // If they're not the same collection, bail; we're in another\n        // selection's event loop.\n        if (!selection || (collection && collection !== selection)) {\n            return;\n        }\n        this.$el.removeClass('selected').attr('aria-checked', false)\n            .find('.check').attr('tabindex', '-1');\n    },\n    /**\n     * @param {Backbone.Model} model\n     * @param {Backbone.Collection} collection\n     */\n    details: function (model, collection) {\n        var selection = this.options.selection,\n            details;\n\n        if (selection !== collection) {\n            return;\n        }\n\n        details = selection.single();\n        this.$el.toggleClass('details', details === this.model);\n    },\n    /**\n     * @param {string} size\n     * @returns {Object}\n     */\n    imageSize: function (size) {\n        var sizes = this.model.get('sizes'), matched = false;\n\n        size = size || 'medium';\n\n        // Use the provided image size if possible.\n        if (sizes) {\n            if (sizes[size]) {\n                matched = sizes[size];\n            } else if (sizes.large) {\n                matched = sizes.large;\n            } else if (sizes.thumbnail) {\n                matched = sizes.thumbnail;\n            } else if (sizes.full) {\n                matched = sizes.full;\n            }\n\n            if (matched) {\n                return _.clone(matched);\n            }\n        }\n\n        return {\n            url: this.model.get('url'),\n            width: this.model.get('width'),\n            height: this.model.get('height'),\n            orientation: this.model.get('orientation')\n        };\n    },\n\n\n    /**\n     * Add the model if it isn't in the selection, if it is in the selection,\n     * remove it.\n     *\n     * @param  {[type]} event [description]\n     * @return {[type]}       [description]\n     */\n    checkClickHandler: function (event) {\n        var selection = this.options.selection;\n        if (!selection) {\n            return;\n        }\n        event.stopPropagation();\n        if (selection.where({id: this.model.get('id')}).length) {\n            selection.remove(this.model);\n            // Move focus back to the attachment tile (from the check).\n            this.$el.focus();\n        } else {\n            selection.add(this.model);\n        }\n    },\n\n    /**\n     * Add the model if it isn't in the selection, if it is in the selection,\n     * remove it.\n     *\n     * @param  {[type]} event [description]\n     * @return {[type]}       [description]\n     */\n    downloadClickHandler: function (event) {\n        this.controller.trigger('download-file', this.model, event.currentTarget);\n    }\n\n});\n\nexport default ShutterpressImage;","import ShutterpressImage from './shutterpress-image'\n\nvar ShutterpressImages = wp.media.View.extend({\n    tagName: 'ul',\n    className: 'attachments',\n\n    attributes: {\n        tabIndex: -1\n    },\n\n    initialize: function () {\n        this.el.id = _.uniqueId('__shutterpress-images-view-');\n\n        _.defaults(this.options, {\n            sortable: false,\n            refreshSensitivity: wp.media.isTouchDevice ? 300 : 200,\n            refreshThreshold: 3,\n            resize: true,\n            idealColumnWidth: $(window).width() < 640 ? 135 : 150\n        });\n\n        this._viewsByCid = {};\n        this.$window = $(window);\n        this.resizeEvent = 'resize.media-modal-columns';\n\n        this.collection.on('add', function (attachment) {\n            this.views.add(this.createAttachmentView(attachment), {\n                at: this.collection.indexOf(attachment)\n            });\n        }, this);\n\n        this.collection.on('remove', function (attachment) {\n            var view = this._viewsByCid[attachment.cid];\n            delete this._viewsByCid[attachment.cid];\n\n            if (view) {\n                view.remove();\n            }\n        }, this);\n\n        this.collection.on('reset', this.render, this);\n        // Throttle the scroll handler and bind this.\n        this.scroll = _.chain(this.scroll).bind(this).throttle(this.options.refreshSensitivity).value();\n\n        this.options.scrollElement = this.options.scrollElement || this.el;\n        $(this.options.scrollElement).on('scroll', this.scroll);\n\n        _.bindAll(this, 'setColumns');\n\n        if (this.options.resize) {\n            this.on('ready', this.bindEvents);\n            this.controller.on('open', this.setColumns);\n\n            // Call this.setColumns() after this view has been rendered in the DOM so\n            // attachments get proper width applied.\n            _.defer(this.setColumns, this);\n        }\n    },\n\n    /**\n     * @param {ShutterpressImage} attachment\n     * @returns {wp.media.View}\n     */\n    createAttachmentView: function (attachment) {\n        var view = new ShutterpressImage({\n            model: attachment,\n            collection: this.collection,\n            selection: this.options.selection,\n            controller: this.controller\n        });\n\n        return this._viewsByCid[attachment.cid] = view;\n    },\n\n    bindEvents: function () {\n        this.$window.off(this.resizeEvent).on(this.resizeEvent, _.debounce(this.setColumns, 50));\n    },\n\n    prepare: function () {\n        // Create all of the Attachment views, and replace\n        // the list in a single DOM operation.\n        if (this.collection.length) {\n            this.views.set(this.collection.map(this.createAttachmentView, this));\n\n            // If there are no elements, clear the views and load some.\n        } else {\n            this.views.unset();\n            this.collection.more();\n        }\n    },\n\n    scroll: function () {\n        var view = this,\n            el = this.options.scrollElement,\n            scrollTop = el.scrollTop,\n            toolbar;\n\n        // The scroll event occurs on the document, but the element\n        // that should be checked is the document body.\n        if (el === document) {\n            el = document.body;\n            scrollTop = $(document).scrollTop();\n        }\n\n        if (!$(el).is(':visible') || !this.collection.hasMore()) {\n            return;\n        }\n\n        toolbar = this.views.parent.toolbar;\n\n        // Show the spinner only if we are close to the bottom.\n        if (el.scrollHeight - (scrollTop + el.clientHeight) < el.clientHeight / 3) {\n            toolbar.get('spinner').show();\n        }\n\n        if (el.scrollHeight < scrollTop + (el.clientHeight * this.options.refreshThreshold)) {\n            this.collection.more().done(function () {\n                view.scroll();\n                toolbar.get('spinner').hide();\n            });\n        }\n    },\n\n    setColumns: function () {\n        var prev = this.columns,\n            width = this.$el.width();\n\n        if (width) {\n            this.columns = Math.min(Math.round(width / this.options.idealColumnWidth), 12) || 1;\n\n            if (!prev || prev !== this.columns) {\n                this.$el.closest('.media-frame-content').attr('data-columns', this.columns);\n            }\n        }\n    },\n\n    show() {\n        this.$el.removeClass('hidden');\n    },\n    hide() {\n        this.$el.addClass('hidden');\n    }\n\n});\n\nexport default ShutterpressImages;","var ShutterpressToolbar = wp.media.View.extend(/** @lends wp.media.view.Toolbar.prototype */{\n    tagName: 'div',\n    className: 'media-toolbar',\n\n    initialize: function () {\n        var state = this.controller.state(),\n            selection = this.selection = state.get('shutterpress-selection'),\n            library = this.library = state.get('shutterpress-images');\n\n        this._views = {};\n\n        // The toolbar is composed of two `PriorityList` views.\n        this.primary = new wp.media.view.PriorityList();\n        this.secondary = new wp.media.view.PriorityList();\n        this.primary.$el.addClass('media-toolbar-primary search-form');\n        this.secondary.$el.addClass('media-toolbar-secondary');\n\n        this.views.set([this.secondary, this.primary]);\n\n        if (this.options.items) {\n            this.set(this.options.items, {silent: true});\n        }\n\n        if (!this.options.silent) {\n            this.render();\n        }\n\n        if (selection) {\n            selection.on('add remove reset', this.refresh, this);\n        }\n\n        if (library) {\n            library.on('add remove reset', this.refresh, this);\n        }\n    },\n    /**\n     * @returns {wp.media.view.Toolbar} Returns itsef to allow chaining\n     */\n    dispose: function () {\n        if (this.selection) {\n            this.selection.off(null, null, this);\n        }\n\n        if (this.library) {\n            this.library.off(null, null, this);\n        }\n        /**\n         * call 'dispose' directly on the parent class\n         */\n        return wp.media.View.prototype.dispose.apply(this, arguments);\n    },\n\n    ready: function () {\n        this.refresh();\n    },\n\n    /**\n     * @param {string} id\n     * @param {Backbone.View|Object} view\n     * @param {Object} [options={}]\n     * @returns {wp.media.view.Toolbar} Returns itself to allow chaining\n     */\n    set: function (id, view, options) {\n        var list;\n        options = options || {};\n\n        // Accept an object with an `id` : `view` mapping.\n        if (_.isObject(id)) {\n            _.each(id, function (view, id) {\n                this.set(id, view, {silent: true});\n            }, this);\n\n        } else {\n            if (!(view instanceof Backbone.View)) {\n                view.classes = ['media-button-' + id].concat(view.classes || []);\n                view = new wp.media.view.Button(view).render();\n            }\n\n            view.controller = view.controller || this.controller;\n\n            this._views[id] = view;\n\n            list = view.options.priority < 0 ? 'secondary' : 'primary';\n            this[list].set(id, view, options);\n        }\n\n        if (!options.silent) {\n            this.refresh();\n        }\n\n        return this;\n    },\n    /**\n     * @param {string} id\n     * @returns {wp.media.view.Button}\n     */\n    get: function (id) {\n        return this._views[id];\n    },\n    /**\n     * @param {string} id\n     * @param {Object} options\n     * @returns {wp.media.view.Toolbar} Returns itself to allow chaining\n     */\n    unset: function (id, options) {\n        delete this._views[id];\n        this.primary.unset(id, options);\n        this.secondary.unset(id, options);\n\n        if (!options || !options.silent) {\n            this.refresh();\n        }\n        return this;\n    },\n\n    refresh: function () {\n        var state = this.controller.state(),\n            library = state.get('shutterpress-images'),\n            selection = state.get('selection');\n\n        _.each(this._views, function (button) {\n            if (!button.model || !button.options || !button.options.requires) {\n                return;\n            }\n\n            var requires = button.options.requires,\n                disabled = false;\n\n            // Prevent insertion of attachments if any of them are still uploading\n            if (selection && selection.models) {\n                disabled = _.some(selection.models, function (attachment) {\n                    return attachment.get('uploading') === true;\n                });\n            }\n\n            if (requires.selection && selection && !selection.length) {\n                disabled = true;\n            } else if (requires.library && library && !library.length) {\n                disabled = true;\n            }\n            button.model.set('disabled', disabled);\n        });\n    }\n});\n\nexport default ShutterpressToolbar;","var ShutterpressSearch = wp.media.View.extend(/** @lends wp.media.view.Search.prototype */{\n    tagName: 'input',\n    className: 'search',\n    id: 'shutterpress-search-input',\n\n    attributes: {\n        type: 'search',\n        placeholder: wp.media.view.l10n.shutterpress.search\n    },\n\n    events: {\n        'input': 'search',\n        'keyup': 'search'\n    },\n\n    /**\n     * @returns {wp.media.view.Search} Returns itself to allow chaining\n     */\n    render: function () {\n        this.el.value = this.model.escape('search');\n        return this;\n    },\n\n    search: _.debounce(function (event) {\n        if (event.target.value) {\n            this.model.set('search', event.target.value);\n        } else {\n            this.model.unset('search');\n        }\n    }, 300)\n});\n\nexport default ShutterpressSearch;","import ShutterpressImage from './shutterpress-image';\n\nvar ShutterpressDetails = ShutterpressImage.extend({\n    tagName: 'div',\n    className: 'attachment-details',\n    template: wp.template('shutterpress-attachment-details'),\n\n    attributes: function () {\n        return {\n            'tabIndex': 0,\n            'data-id': this.model.get('id')\n        };\n    },\n\n\n    initialize: function () {\n        this.options = _.defaults(this.options, {\n            rerenderOnModelChange: false\n        });\n\n        this.on('ready', this.initialFocus);\n        // Call 'initialize' directly on the parent class.\n        ShutterpressImage.prototype.initialize.apply(this, arguments);\n    },\n\n    initialFocus: function () {\n        if (!wp.media.isTouchDevice) {\n            this.$('input[type=\"text\"]').eq(0).focus();\n        }\n    },\n\n});\n\nexport default ShutterpressDetails;","var ShutterpressSidebar = wp.media.View.extend({\n    tagName: 'div',\n    className: 'media-sidebar shutterpress-sidebar',\n\n    initialize: function () {\n        this._views = {};\n\n        this.set(_.extend({}, this._views, this.options.views), {silent: true});\n        delete this.options.views;\n\n        if (!this.options.silent) {\n            this.render();\n        }\n    },\n    /**\n     * @param {string} id\n     * @param {wp.media.View|Object} view\n     * @param {Object} options\n     * @returns {wp.media.view.PriorityList} Returns itself to allow chaining\n     */\n    set: function (id, view, options) {\n        var priority, views, index;\n\n        options = options || {};\n\n        // Accept an object with an `id` : `view` mapping.\n        if (_.isObject(id)) {\n            _.each(id, function (view, id) {\n                this.set(id, view);\n            }, this);\n            return this;\n        }\n\n        if (!(view instanceof Backbone.View)) {\n            view = this.toView(view, id, options);\n        }\n        view.controller = view.controller || this.controller;\n\n        this.unset(id);\n\n        priority = view.options.priority || 10;\n        views = this.views.get() || [];\n\n        _.find(views, function (existing, i) {\n            if (existing.options.priority > priority) {\n                index = i;\n                return true;\n            }\n        });\n\n        this._views[id] = view;\n        this.views.add(view, {\n            at: _.isNumber(index) ? index : views.length || 0\n        });\n\n        return this;\n    },\n    /**\n     * @param {string} id\n     * @returns {wp.media.View}\n     */\n    get: function (id) {\n        return this._views[id];\n    },\n    /**\n     * @param {string} id\n     * @returns {wp.media.view.PriorityList}\n     */\n    unset: function (id) {\n        var view = this.get(id);\n\n        if (view) {\n            view.remove();\n        }\n\n        delete this._views[id];\n        return this;\n    },\n    /**\n     * @param {Object} options\n     * @returns {wp.media.View}\n     */\n    toView: function (options) {\n        return new wp.media.View(options);\n    }\n});\n\nexport default ShutterpressSidebar;","var ShutterpressEmpty = wp.media.View.extend(/** @lends wp.media.view.Toolbar.prototype */{\n    tagName: 'div',\n    className: 'shutterpress-empty',\n    template: wp.template('shutterpress-empty'),\n\n    events: {\n        'click .retry': 'retry'\n    },\n\n    defaults: {\n        message: '',\n        link: false,\n        retry: true,\n    },\n\n    initialize: function () {\n        this.model = new Backbone.Model(this.defaults);\n        // If any of the `options` have a key from `defaults`, apply its\n        // value to the `model` and remove it from the `options object.\n        _.each(this.defaults, function (def, key) {\n            var value = this.options[key];\n            if (_.isUndefined(value)) {\n                return;\n            }\n\n            this.model.set(key, value);\n            delete this.options[key];\n        }, this);\n        this.listenTo(this.model, 'change', this.render);\n\n    },\n\n    prepare() {\n        return this.model.toJSON()\n    },\n\n\n    retry() {\n        this.options.browser.updateContent();\n    },\n\n    show() {\n        this.$el.removeClass('hidden');\n    },\n    hide() {\n        this.$el.addClass('hidden');\n    }\n\n\n});\n\nexport default ShutterpressEmpty;","var ShutterpressCheckboxFilters = wp.media.View.extend(/** @lends wp.media.view.AttachmentFilters.prototype */{\n    className: 'checkbox-shutterpress-filters',\n\n\n    keys: [],\n    checked: [],\n\n    initialize: function () {\n        this.createFilters();\n        this.createChecked();\n        _.extend(this.filters, this.options.filters);\n        var $mainLabel = $('<span></span>', {'text': this.label, 'class': 'group-label'});\n        // Build `<option>` elements.\n        this.$el.html(_.chain(this.filters).map(function (filter, value) {\n            var $el = $('<input />', {type: 'checkbox', value: value, id: filter.id});\n            var t = this;\n            $el.on('change', function (e) {\n                t.checkboxChange($(this), e)\n            });\n            var $label = $('<label />', {for: filter.id, text: filter.text});\n            var $wrapper = $('<span>', {'class': 'checkbox-component'}).append($el).append($label);\n            return {\n                el: $wrapper[0],\n                priority: filter.priority || 50\n            };\n        }, this).sortBy('priority').pluck('el').value());\n        this.$el.prepend($mainLabel);\n        this.$el.wrap('<div class=\"' + this.className + '\"></div>');\n        this.controller.on('update-filters', _.bind(this.updateFilters, this));\n    },\n\n    /**\n     * @abstract\n     */\n    createFilters: function () {\n        this.filters = {};\n    },\n\n    /**\n     * @abstract\n     */\n    createChecked: function () {\n        this.checked = [];\n    },\n\n    updateFilters: function () {\n        this.model.set(this.name, this.getValue());\n\n    },\n\n    getValue() {\n        if (!this.checked.length) {\n            return null;\n        }\n        if (!this.multiple && this.checked.length > 1) {\n            return this.default;\n        }\n        if (this.multiple) {\n            return this.checked;\n        }\n\n        return this.checked[0];\n    },\n\n    checkboxChange($element) {\n        var value = $element.val();\n        var checked = $element.is(':checked');\n        if (checked) {\n            this.checked.push(value);\n        } else {\n            this.checked = this.checked.filter(function (val) {\n\n                return value !== val;\n\n            });\n        }\n\n    }\n});\n\nexport default ShutterpressCheckboxFilters;","import ShutterpressCheckboxFilters from './shutterpress-checkbox-filter';\n\nvar ShutterpressGenderFilters = ShutterpressCheckboxFilters.extend(/** @lends wp.media.view.AttachmentFilters.All.prototype */{\n    className: 'advanced-filters gender-filter',\n    id: 'shutterpress-gender-filter',\n    createFilters: function () {\n        var filters = {};\n\n\n        filters.female = {\n            text: wp.media.view.l10n.shutterpress.filters.gender.female,\n            props: {\n                people_gender: 'female',\n            },\n            priority: 20,\n            id: 'shutterpress-gender-female'\n        };\n\n        filters.male = {\n            text: wp.media.view.l10n.shutterpress.filters.gender.male,\n            props: {\n                people_gender: 'male',\n            },\n            priority: 30,\n            id: 'shutterpress-gender-male'\n        };\n\n\n        this.filters = filters;\n        this.label = wp.media.view.l10n.shutterpress.filters.gender.label;\n        this.name = 'people_gender';\n        this.default = 'both';\n        this.multiple = false\n    }\n});\nexport default ShutterpressGenderFilters;","var ShutterpressImageModel = Backbone.Model.extend(/** @lends wp.media.model.Attachment.prototype */{\n    /**\n     * Triggered when attachment details change\n     * Overrides Backbone.Model.sync\n     *\n     * @param {string} method\n     * @param {wp.media.model.Attachment} model\n     * @param {Object} [options={}]\n     *\n     * @returns {Promise}\n     */\n    sync: function (method, model, options) {\n        // If the attachment does not yet have an `id`, return an instantly\n        // rejected promise. Otherwise, all of our requests will fail.\n        if (_.isUndefined(this.id)) {\n            return $.Deferred().rejectWith(this).promise();\n        }\n\n        // Overload the `read` request so Attachment.fetch() functions correctly.\n        if ('read' === method) {\n            options = options || {};\n            options.context = this;\n            options.data = _.extend(options.data || {}, {\n                action: 'get-shutterpress-image',\n                id: this.id\n            });\n            return wp.media.ajax(options);\n\n            // Overload the `update` request so properties can be saved.\n        }else if ( 'update' === method ) {\n            // If we do not have the necessary nonce, fail immeditately.\n            if ( ! this.get('nonces') || ! this.get('nonces').update ) {\n                return $.Deferred().rejectWith( this ).promise();\n            }\n\n            options = options || {};\n            options.context = this;\n\n            // Set the action and ID.\n            options.data = _.extend( options.data || {}, {\n                action:  'save-attachment',\n                id:      this.id,\n                nonce:   this.get('nonces').update,\n                post_id: wp.media.model.settings.post.id\n            });\n\n            // Record the values of the changed attributes.\n            if ( model.hasChanged() ) {\n                options.data.changes = {};\n\n                _.each( model.changed, function( value, key ) {\n                    options.data.changes[ key ] = this.get( key );\n                }, this );\n            }\n\n            return wp.media.ajax( options );\n\n            // Overload the `delete` request so attachments can be removed.\n            // This will permanently delete an attachment.\n        } else {\n            /**\n             * Call `sync` directly on Backbone.Model\n             */\n            return Backbone.Model.prototype.sync.apply(this, arguments);\n        }\n    },\n\n    progress: function() {\n        if ( this.$bar && this.$bar.length ) {\n            this.$bar.width( this.model.get('percent') + '%' );\n        }\n    },\n\n}, {\n    /**\n     * Create a new model on the static 'all' attachments collection and return it.\n     *\n     * @static\n     *\n     * @param {Object} attrs\n     * @returns {ShutterpressImageModel}\n     */\n    create: function (attrs) {\n        var Images = ShutterpressImageModel;\n        return Images.all.push(attrs);\n    },\n    /**\n     * Create a new model on the static 'all' attachments collection and return it.\n     *\n     * If this function has already been called for the id,\n     * it returns the specified attachment.\n     *\n     * @static\n     * @param {string} id A string used to identify a model.\n     * @param {Backbone.Model|undefined} attachment\n     * @returns {ShutterpressImageModel}\n     */\n    get: _.memoize(function (id, attachment) {\n        var Images = ShutterpressImageModel;\n        return Images.all.push(attachment || {id: id});\n    })\n});\n\nexport default ShutterpressImageModel","import ShutterpressImageModel from \"./models/shutterpress-image-model\";\n\n/** @global ShuttepressQueue */\n\nvar ShutterpressDownloader = wp.media.View.extend({\n    tagName: 'div',\n    className: 'shutterpress-downloader',\n    template: wp.template('shutterpress-downloader'),\n    file: null,\n    /**\n     * Bind drag'n'drop events to callbacks.\n     */\n    initialize: function () {\n        this.options = _.defaults(this.options, {\n            state: false\n        });\n        this.on('upload-completed', function (attachment) {\n\n            _.each(['file', 'loaded', 'size', 'percent'], (key) => {\n                this.file.attachment.unset(key);\n            });\n\n            this.file.attachment.set(_.extend(attachment, {uploading: false}));\n            wp.media.model.Attachment.get(attachment.id, this.file.attachment);\n\n            var complete = ShutterpressQueue.all(function (attachment) {\n                return !attachment.get('uploading');\n            });\n\n            if (complete)\n                ShutterpressQueue.reset();\n        });\n\n\n        this.controller.on('download-file', this.downloadTrigger, this);\n\n        return this;\n    },\n\n    events: {\n        'click .download-shutterpress-image': 'download'\n    },\n\n    prepare() {\n        return {\n            'download': wp.media.view.l10n.shutterpress.download\n        }\n    },\n\n    download() {\n        this.addFileToQueue();\n    },\n\n    downloadTrigger(model,target) {\n       if(this.model===model) {\n           this.addFileToQueue();\n       }\n    },\n\n    openMediaTab() {\n        var state = this.options.state;\n        if ('shutterpress' === this.controller.content.mode()) {\n            this.controller.content.mode('browse');\n        }\n        state.get('selection').add(this.file.attachment);\n        this.controller.trigger('library:selection:add');\n\n    },\n\n    addFileToQueue() {\n        // Generate attributes for a new `Attachment` model.\n        var attributes = _.extend({\n            item: this.model,\n            uploading: true,\n            date: new Date(),\n            menuOrder: 0,\n            progress: 0,\n            filename: '',\n            uploadedTo: wp.media.model.settings.post.id\n        });\n\n        this.file = {\n            shutterpressId: this.model.id,\n            attachment: new wp.media.model.Attachment(attributes)\n        }\n        ShutterpressQueue.add(this.file.attachment);\n        this.openMediaTab();\n        this.getFile();\n    },\n\n\n    getFile() {\n        var options = options || {};\n        options.context = this;\n        options.data = _.extend(options.data || {}, {\n            action: 'cache-shutterpress',\n            media_id: this.file.shutterpressId,\n            post_id: wp.media.model.settings.post.id\n        });\n        // try cache first\n        return wp.media.ajax(options).done(function (response) {\n            this.trigger('upload-completed', response)\n        }).fail(function () {\n            // set percent to half\n            this.file.attachment.set(\"percent\", 30);\n            this.downloadFile()\n        });\n    },\n\n    downloadFile() {\n        var options = options || {};\n        options.context = this;\n        options.data = _.extend(options.data || {}, {\n            action: 'download-shutterpress',\n            media_id: this.file.shutterpressId,\n            post_id: wp.media.model.settings.post.id,\n            description: this.model.get('description')\n        });\n        var t = this;\n        var loading = setInterval(() => {\n            t.incrementPercent();\n        }, 1000);\n        wp.media.ajax(options).done(function (response) {\n            clearInterval(loading);\n            this.trigger('upload-completed', response)\n        }).fail(function (response) {\n            clearInterval(loading);\n            this.error(response.message, null, this.file);\n        });\n\n    },\n\n    incrementPercent() {\n        if (this.file.attachment.get('percent') < 99) {\n            this.file.attachment.set({\n                percent: this.file.attachment.get('percent') + 4\n            })\n        }\n    },\n\n    /**\n     * Custom error callback.\n     *\n     * Add a new error to the errors collection, so other modules can track\n     * and display errors. @see wp.Uploader.errors.\n     *\n     * @param  {string}        message\n     * @param  {object}        data\n     * @param  {plupload.File} file     File that was uploaded.\n     */\n    error(message, data, file) {\n        if (file.attachment) {\n            file.attachment.destroy();\n        }\n\n        wp.Uploader.errors.unshift({\n            message: message || pluploadL10n.default_error,\n            data: data,\n            file: file\n        });\n\n    }\n\n\n});\n\nexport default ShutterpressDownloader;","var ShutterpressAdvancedLink = wp.media.View.extend(/** @lends wp.media.view.Search.prototype */{\n    tagName: 'a',\n    className: 'shutterpress-advanced',\n    id: 'shutterpress-advanced-link',\n    defaults: {\n        text: '',\n        disabled: false\n    },\n\n    initialize: function () {\n        /**\n         * Create a model with the provided `defaults`.\n         *\n         * @member {Backbone.Model}\n         */\n        this.model = new Backbone.Model(this.defaults);\n\n        // If any of the `options` have a key from `defaults`, apply its\n        // value to the `model` and remove it from the `options object.\n        _.each(this.defaults, function (def, key) {\n            var value = this.options[key];\n            if (_.isUndefined(value)) {\n                return;\n            }\n\n            this.model.set(key, value);\n            delete this.options[key];\n        }, this);\n\n        this.listenTo(this.model, 'change', this.render);\n    },\n\n    /**\n     * @returns {wp.media.view.Button} Returns itself to allow chaining\n     */\n    render: function () {\n        var classes = [this.className],\n            model = this.model.toJSON();\n\n        classes = _.uniq(classes.concat(this.options.classes));\n        this.el.className = classes.join(' ');\n\n        this.$el.attr('disabled', model.disabled);\n        this.$el.text(this.model.get('text'));\n\n        return this;\n    },\n\n    events: {\n        'click': 'toggleAdvanced',\n    },\n\n    toggleAdvanced: function () {\n        $('#shutterpress-advanced-filters').toggleClass('visible');\n    }\n});\n\nexport default ShutterpressAdvancedLink;","var ShutterpressAdvancedFilters = wp.media.View.extend(/** @lends wp.media.view.Search.prototype */{\n    tagName: 'div',\n    className: 'shutterpress-advanced-filters',\n    id: 'shutterpress-advanced-filters',\n\n    attributes: {\n    },\n\n    /**\n     * @returns {wp.media.view.Search} Returns itself to allow chaining\n     */\n    initialize: function () {\n        var state = this.controller.state()\n\n        this._views = {};\n\n        // The toolbar is composed of two `PriorityList` views.\n        this.filters = new wp.media.view.PriorityList();\n        this.actions = new wp.media.view.PriorityList();\n        this.actions.$el.addClass('shutterpress-filters-actions');\n        this.filters.$el.addClass('shutterpress-filters-sub-container');\n\n        this.views.set([ this.filters,this.actions]);\n\n        if (this.options.items) {\n            this.set(this.options.items, {silent: true});\n        }\n\n        if (!this.options.silent) {\n            this.render();\n        }\n    },\n\n    ready: function () {\n        this.refresh();\n    },\n\n    /**\n     * @param {string} id\n     * @param {Backbone.View|Object} view\n     * @param {Object} [options={}]\n     * @returns {wp.media.view.Toolbar} Returns itself to allow chaining\n     */\n    set: function (id, view, options) {\n        var list;\n        options = options || {};\n\n        // Accept an object with an `id` : `view` mapping.\n        if (_.isObject(id)) {\n            _.each(id, function (view, id) {\n                this.set(id, view, {silent: true});\n            }, this);\n\n        } else {\n            if (!(view instanceof Backbone.View)) {\n                view.classes = ['media-button-' + id].concat(view.classes || []);\n                view = new wp.media.view.Button(view).render();\n            }\n\n            view.controller = view.controller || this.controller;\n\n            this._views[id] = view;\n\n            list = view.options.priority < 0 ? 'filters' : 'actions';\n            this[list].set(id, view, options);\n        }\n\n        if (!options.silent) {\n            this.refresh();\n        }\n\n        return this;\n    },\n    /**\n     * @param {string} id\n     * @returns {wp.media.view.Button}\n     */\n    get: function (id) {\n        return this._views[id];\n    },\n    /**\n     * @param {string} id\n     * @param {Object} options\n     * @returns {wp.media.view.Toolbar} Returns itself to allow chaining\n     */\n    unset: function (id, options) {\n        delete this._views[id];\n        this.link.unset(id, options);\n        this.filters.unset(id, options);\n\n        if (!options || !options.silent) {\n            this.refresh();\n        }\n        return this;\n    },\n\n    refresh: function () {\n        var state = this.controller.state(),\n            library = state.get('shutterpress-images'),\n            selection = state.get('selection');\n\n        _.each(this._views, function (button) {\n            if (!button.model || !button.options || !button.options.requires) {\n                return;\n            }\n\n            var requires = button.options.requires,\n                disabled = false;\n\n            // Prevent insertion of attachments if any of them are still uploading\n            if (selection && selection.models) {\n                disabled = _.some(selection.models, function (attachment) {\n                    return attachment.get('uploading') === true;\n                });\n            }\n\n            if (requires.selection && selection && !selection.length) {\n                disabled = true;\n            } else if (requires.library && library && !library.length) {\n                disabled = true;\n            }\n            button.model.set('disabled', disabled);\n        });\n    }\n});\n\nexport default ShutterpressAdvancedFilters;","var ShutterpressAdvanced = wp.media.View.extend(/** @lends wp.media.view.Search.prototype */{\n    tagName: 'div',\n    className: 'shutterpress-advanced',\n    id: 'shutterpress-advanced-area',\n\n    attributes: {},\n\n\n    /**\n     * @returns {wp.media.view.Search} Returns itself to allow chaining\n     */\n    initialize: function () {\n        var state = this.controller.state()\n\n        this._views = {};\n\n        // The toolbar is composed of two `PriorityList` views.\n        this.link = new wp.media.view.PriorityList();\n        this.filters = new wp.media.view.PriorityList();\n        this.link.$el.addClass('shutterpress-filters-trigger');\n        this.filters.$el.addClass('shutterpress-filters-container');\n\n        this.views.set([this.link, this.filters]);\n\n        if (this.options.items) {\n            this.set(this.options.items, {silent: true});\n        }\n\n        if (!this.options.silent) {\n            this.render();\n        }\n    },\n\n    ready: function () {\n        this.refresh();\n    },\n\n    /**\n     * @param {string} id\n     * @param {Backbone.View|Object} view\n     * @param {Object} [options={}]\n     * @returns {wp.media.view.Toolbar} Returns itself to allow chaining\n     */\n    set: function (id, view, options) {\n        var list;\n        options = options || {};\n\n        // Accept an object with an `id` : `view` mapping.\n        if (_.isObject(id)) {\n            _.each(id, function (view, id) {\n                this.set(id, view, {silent: true});\n            }, this);\n\n        } else {\n            if (!(view instanceof Backbone.View)) {\n                view.classes = ['media-button-' + id].concat(view.classes || []);\n                view = new wp.media.view.Button(view).render();\n            }\n\n            view.controller = view.controller || this.controller;\n\n            this._views[id] = view;\n\n            list = view.options.priority < 0 ? 'link' : 'filters';\n            this[list].set(id, view, options);\n        }\n\n        if (!options.silent) {\n            this.refresh();\n        }\n\n        return this;\n    },\n    /**\n     * @param {string} id\n     * @returns {wp.media.view.Button}\n     */\n    get: function (id) {\n        return this._views[id];\n    },\n    /**\n     * @param {string} id\n     * @param {Object} options\n     * @returns {wp.media.view.Toolbar} Returns itself to allow chaining\n     */\n    unset: function (id, options) {\n        delete this._views[id];\n        this.link.unset(id, options);\n        this.filters.unset(id, options);\n\n        if (!options || !options.silent) {\n            this.refresh();\n        }\n        return this;\n    },\n\n    refresh: function () {\n        var state = this.controller.state(),\n            library = state.get('shutterpress-images'),\n            selection = state.get('selection');\n\n        _.each(this._views, function (button) {\n            if (!button.model || !button.options || !button.options.requires) {\n                return;\n            }\n\n            var requires = button.options.requires,\n                disabled = false;\n\n            // Prevent insertion of attachments if any of them are still uploading\n            if (selection && selection.models) {\n                disabled = _.some(selection.models, function (attachment) {\n                    return attachment.get('uploading') === true;\n                });\n            }\n\n            if (requires.selection && selection && !selection.length) {\n                disabled = true;\n            } else if (requires.library && library && !library.length) {\n                disabled = true;\n            }\n            button.model.set('disabled', disabled);\n        });\n    }\n});\n\nexport default ShutterpressAdvanced;","var ShutterpressFilterButton = wp.media.View.extend(/** @lends wp.media.view.Search.prototype */{\n    tagName: 'a',\n    className: 'shutterpress-start-filter button-primary button-large',\n    defaults: {\n        text: '',\n        disabled: false\n    },\n\n    initialize: function () {\n        /**\n         * Create a model with the provided `defaults`.\n         *\n         * @member {Backbone.Model}\n         */\n        this.model = new Backbone.Model(this.defaults);\n\n        // If any of the `options` have a key from `defaults`, apply its\n        // value to the `model` and remove it from the `options object.\n        _.each(this.defaults, function (def, key) {\n            var value = this.options[key];\n            if (_.isUndefined(value)) {\n                return;\n            }\n\n            this.model.set(key, value);\n            delete this.options[key];\n        }, this);\n\n        this.listenTo(this.model, 'change', this.render);\n    },\n\n    /**\n     * @returns {wp.media.view.Button} Returns itself to allow chaining\n     */\n    render: function () {\n        var classes = [this.className],\n            model = this.model.toJSON();\n\n        classes = _.uniq(classes.concat(this.options.classes));\n        this.el.className = classes.join(' ');\n\n        this.$el.attr('disabled', model.disabled);\n        this.$el.text(this.model.get('text'));\n\n        return this;\n    },\n\n    events: {\n        'click': 'triggerFilter',\n    },\n\n    triggerFilter: function () {\n        this.controller.trigger('update-filters', this.model, event.currentTarget);\n    }\n});\n\nexport default ShutterpressFilterButton;","import ShutterpressCheckboxFilters from './shutterpress-checkbox-filter';\n\nvar ShutterpressOrientationFilters = ShutterpressCheckboxFilters.extend(/** @lends wp.media.view.AttachmentFilters.All.prototype */{\n    className: 'advanced-filters orientation-filter',\n    id: 'shutterpress-gender-filter',\n    createFilters: function () {\n        var filters = {};\n\n\n        filters.horizontal = {\n            text: wp.media.view.l10n.shutterpress.filters.orientation.horizontal,\n            props: {\n                orientation: 'horizontal',\n            },\n            priority: 20,\n            id: 'shutterpress-orientation-horizontal'\n        };\n\n        filters.vertical = {\n            text: wp.media.view.l10n.shutterpress.filters.orientation.vertical,\n            props: {\n                orientation: 'vertical',\n            },\n            priority: 30,\n            id: 'shutterpress-orientation-vertical'\n        };\n\n\n        this.filters = filters;\n        this.label = wp.media.view.l10n.shutterpress.filters.orientation.label;\n        this.name = 'orientation';\n        this.default = null;\n        this.multiple = false\n    }\n});\nexport default ShutterpressOrientationFilters;","import ShutterpressCheckboxFilters from './shutterpress-checkbox-filter';\n\nvar ShutterpressImageFilters = ShutterpressCheckboxFilters.extend(/** @lends wp.media.view.AttachmentFilters.All.prototype */{\n    className: 'advanced-filters image-type-filter',\n    id: 'shutterpress-image-type-filter',\n    createFilters: function () {\n        var filters = {};\n\n\n        filters.photo = {\n            text: wp.media.view.l10n.shutterpress.filters.image_type.photo,\n            props: {\n                image_type: 'photo',\n            },\n            priority: 20,\n            id: 'shutterpress-image-type-photo'\n        };\n\n        filters.vector = {\n            text: wp.media.view.l10n.shutterpress.filters.image_type.vector,\n            props: {\n                image_type: 'vector',\n            },\n            priority: 30,\n            id: 'shutterpress-image-type-vector'\n        };\n\n        filters.illustration = {\n            text: wp.media.view.l10n.shutterpress.filters.image_type.illustration,\n            props: {\n                image_type: 'illustration',\n            },\n            priority: 30,\n            id: 'shutterpress-image-photo-illustration'\n        };\n\n\n        this.filters = filters;\n        this.label = wp.media.view.l10n.shutterpress.filters.image_type.label;\n        this.name = 'image_type';\n        this.default = null;\n        this.multiple = true\n    }\n});\nexport default ShutterpressImageFilters;","var ShutterpressSelectFilters = wp.media.View.extend(/** @lends wp.media.view.AttachmentFilters.prototype */{\n    tagName: 'div',\n    className: 'shutterpress-select-filters',\n\n    keys: [],\n\n    initialize: function () {\n        this.createFilters();\n        _.extend(this.filters, this.options.filters);\n\n        var $mainLabel = $('<span></span>', {'text': this.label, 'class': 'group-label'});\n        var $select = $('<select />');\n        // Build `<option>` elements.\n        $select.html(_.chain(this.filters).map(function (filter, value) {\n            return {\n                el: $('<option></option>').val(value).html(filter.text)[0],\n                priority: filter.priority || 50\n            };\n        }, this).sortBy('priority').pluck('el').value());\n\n        this.$el.prepend($select);\n        this.$el.prepend($mainLabel);\n        this.controller.on('update-filters', _.bind(this.change, this));\n    },\n\n    /**\n     * @abstract\n     */\n    createFilters: function () {\n        this.filters = {};\n    },\n\n    /**\n     * When the selected filter changes, update the Attachment Query properties to match.\n     */\n    change: function () {\n        var filter = this.filters[this.getValue()];\n        if (filter) {\n            this.model.set(filter.props);\n        }\n    },\n\n    getValue() {\n        return this.$el.find('select').val();\n    }\n\n});\n\nexport default ShutterpressSelectFilters;","import ShutterpressSelectFilters from \"./shutterpress-select-filter\";\nvar slugify = require('slugify')\nvar ShutterpressCategoryFilters = ShutterpressSelectFilters.extend(/** @lends wp.media.view.AttachmentFilters.All.prototype */{\n    className: 'advanced-filters category-filter',\n    id: 'shutterpress-category-filter',\n    createFilters: function () {\n        var filters = {};\n\n\n        var priority = 1;\n        filters.default = {\n            text: wp.media.view.l10n.shutterpress.filters.categories.default,\n            props: {\n                category: null,\n            },\n            priority: priority,\n            id: 'shutterpress-category-default'\n        };\n        var values = wp.media.view.l10n.shutterpress.filters.categories.values;\n        for (let [key, value] of Object.entries(values)) {\n            if (values.hasOwnProperty(key)) {\n                priority++;\n                filters[key] = {\n                    text: values[key],\n                    props: {\n                        category: key,\n                    },\n                    priority: priority,\n                    id: 'shutterpress-category-' + slugify(key)\n                }\n            }\n        }\n\n\n        this.filters = filters;\n        this.label = wp.media.view.l10n.shutterpress.filters.categories.label;\n        this.name = 'category';\n        this.default = null;\n    }\n});\nexport default ShutterpressCategoryFilters;","import ShutterpressImageModel from './shutterpress-image-model';\n\nvar ShutterpressImagesModel = Backbone.Collection.extend(/** @lends wp.media.model.Attachments.prototype */{\n\n    /**\n     * @type {ShutterpressImageModel}\n     */\n    model: ShutterpressImageModel,\n    /**\n     * @param {Array} [models=[]] Array of models used to populate the collection.\n     * @param {Object} [options={}]\n     */\n    initialize: function (models, options) {\n        options = options || {};\n\n        this.props = new Backbone.Model();\n\n        this.filters = options.filters || {};\n        this.props.on('change', _.debounce(this._changeFilteredProps,250), this);\n        this.props.on('change:query', _.debounce(this._changeQuery,250), this);\n\n        this.props.set(_.defaults(options.props || {}));\n\n    },\n\n    /**\n     * Start mirroring another attachments collection, clearing out any models already\n     * in the collection.\n     *\n     * @param {wp.media.model.Attachments} The attachments collection to mirror.\n     * @returns {wp.media.model.Attachments} Returns itself to allow chaining\n     */\n    mirror: function (attachments) {\n        if (this.mirroring && this.mirroring === attachments) {\n            return this;\n        }\n\n        this.unmirror();\n        this.mirroring = attachments;\n\n        // Clear the collection silently. A `reset` event will be fired\n        // when `observe()` calls `validateAll()`.\n        this.reset([], {silent: true});\n        this.observe(attachments);\n\n        return this;\n    },\n    /**\n     * Stop mirroring another attachments collection.\n     */\n    unmirror: function () {\n        if (!this.mirroring) {\n            return;\n        }\n\n        this.unobserve(this.mirroring);\n        delete this.mirroring;\n    },\n\n    /**\n     * If the `query` property is set to true, query the server using\n     * the `props` values, and sync the results to this collection.\n     *\n     * @access private\n     *\n     * @param {Backbone.Model} model\n     * @param {Boolean} query\n     */\n    _changeQuery: function (model, query) {\n        if (query) {\n            this.props.on('change', _.debounce(this._requery,250), this);\n            this._requery();\n        } else {\n            this.props.off('change', this._requery, this);\n        }\n    },\n    /**\n     * @access private\n     *\n     * @param {Backbone.Model} model\n     */\n    _changeFilteredProps: function (model) {\n        // If this is a query, updating the collection will be handled by\n        // `this._requery()`.\n        if (this.props.get('query')) {\n            return;\n        }\n\n        var changed = _.chain(model.changed).map(function (t, prop) {\n            var filter = ShutterpressImagesModel.filters[prop],\n                term = model.get(prop);\n\n            if (!filter) {\n                return;\n            }\n\n            if (term && !this.filters[prop]) {\n                this.filters[prop] = filter;\n            } else if (!term && this.filters[prop] === filter) {\n                delete this.filters[prop];\n            } else {\n                return;\n            }\n\n            // Record the change.\n            return true;\n        }, this).any().value();\n\n        if (!changed) {\n            return;\n        }\n\n        // If no `ShutterPressImagesModel` model is provided to source the searches\n        // from, then automatically generate a source from the existing\n        // models.\n        if (!this._source) {\n            this._source = new ShutterpressImagesModel(this.models);\n        }\n\n        this.reset(this._source.filter(this.validator, this));\n    },\n\n    /**\n     * If the collection is a query, create and mirror an Attachments Query collection.\n     *\n     * @access private\n     */\n    _requery: function (refresh) {\n        var props;\n        if (this.props.get('query')) {\n            props = this.props.toJSON();\n            props.cache = (true !== refresh);\n            this.mirror(ShutterpressQuery.get(props));\n        }\n    },\n\n    /**\n     * Retrieve more attachments from the server for the collection.\n     *\n     * Only works if the collection is mirroring a Query Attachments collection,\n     * and forwards to its `more` method. This collection class doesn't have\n     * server persistence by itself.\n     *\n     * @param {object} options\n     * @returns {Promise}\n     */\n    more: function (options) {\n        var deferred = jQuery.Deferred(),\n            mirroring = this.mirroring,\n            attachments = this;\n\n        if (!mirroring || !mirroring.more) {\n            return deferred.resolveWith(this).promise();\n        }\n        // If we're mirroring another collection, forward `more` to\n        // the mirrored collection. Account for a race condition by\n        // checking if we're still mirroring that collection when\n        // the request resolves.\n        mirroring.more(options).done(function () {\n            if (this === attachments.mirroring) {\n                deferred.resolveWith(this);\n            }\n        }).fail(function (message) {\n            if (this === attachments.mirroring) {\n                deferred.rejectWith(this, message);\n            }\n        })\n\n        return deferred.promise();\n    },\n    /**\n     * Whether there are more attachments that haven't been sync'd from the server\n     * that match the collection's query.\n     *\n     * Only works if the collection is mirroring a Query Attachments collection,\n     * and forwards to its `hasMore` method. This collection class doesn't have\n     * server persistence by itself.\n     *\n     * @returns {boolean}\n     */\n    hasMore: function () {\n        return this.mirroring ? this.mirroring.hasMore() : false;\n    },\n\n    validateDestroyed: false,\n    /**\n     * Checks whether an attachment is valid.\n     *\n     * @param {wp.media.model.Attachment} attachment\n     * @returns {Boolean}\n     */\n    validator: function (attachment) {\n\n        // Filter out contextually created attachments (e.g. headers, logos, etc.).\n        if (\n            !_.isUndefined(attachment.attributes.context) &&\n            '' !== attachment.attributes.context\n        ) {\n            return false;\n        }\n\n        if (!this.validateDestroyed && attachment.destroyed) {\n            return false;\n        }\n        return _.all(this.filters, function (filter) {\n            return !!filter.call(this, attachment);\n        }, this);\n    },\n\n    /**\n     * Add or remove an attachment to the collection depending on its validity.\n     *\n     * @param {wp.media.model.Attachment} attachment\n     * @param {Object} options\n     * @returns {wp.media.model.Attachments} Returns itself to allow chaining\n     */\n    validate: function (attachment, options) {\n        var valid = this.validator(attachment),\n            hasAttachment = !!this.get(attachment.cid);\n\n        if (!valid && hasAttachment) {\n            this.remove(attachment, options);\n        } else if (valid && !hasAttachment) {\n            this.add(attachment, options);\n        }\n\n        return this;\n    },\n\n    /**\n     * Add or remove all attachments from another collection depending on each one's validity.\n     *\n     * @param {wp.media.model.Attachments} attachments\n     * @param {object} [options={}]\n     *\n     * @fires wp.media.model.Attachments#reset\n     *\n     * @returns {wp.media.model.Attachments} Returns itself to allow chaining\n     */\n    validateAll: function (attachments, options) {\n        options = options || {};\n\n        _.each(attachments.models, function (attachment) {\n            this.validate(attachment, {silent: true});\n        }, this);\n\n        if (!options.silent) {\n            this.trigger('reset', this, options);\n        }\n        return this;\n    },\n    /**\n     * Start observing another attachments collection change events\n     * and replicate them on this collection.\n     *\n     * @param {wp.media.model.Attachments} The attachments collection to observe.\n     * @returns {wp.media.model.Attachments} Returns itself to allow chaining.\n     */\n    observe: function (attachments) {\n        this.observers = this.observers || [];\n        this.observers.push(attachments);\n\n        attachments.on('add change remove', this._validateHandler, this);\n        attachments.on('reset', this._validateAllHandler, this);\n        this.validateAll(attachments);\n        return this;\n    },\n    /**\n     * Stop replicating collection change events from another attachments collection.\n     *\n     * @param {wp.media.model.Attachments} The attachments collection to stop observing.\n     * @returns {wp.media.model.Attachments} Returns itself to allow chaining\n     */\n    unobserve: function (attachments) {\n        if (attachments) {\n            attachments.off(null, null, this);\n            this.observers = _.without(this.observers, attachments);\n\n        } else {\n            _.each(this.observers, function (attachments) {\n                attachments.off(null, null, this);\n            }, this);\n            delete this.observers;\n        }\n\n        return this;\n    },\n    /**\n     * @access private\n     *\n     * @param {wp.media.model.Attachments} attachment\n     * @param {wp.media.model.Attachments} attachments\n     * @param {Object} options\n     *\n     * @returns {wp.media.model.Attachments} Returns itself to allow chaining\n     */\n    _validateHandler: function (attachment, attachments, options) {\n        // If we're not mirroring this `attachments` collection,\n        // only retain the `silent` option.\n        options = attachments === this.mirroring ? options : {\n            silent: options && options.silent\n        };\n\n        return this.validate(attachment, options);\n    },\n    /**\n     * @access private\n     *\n     * @param {wp.media.model.Attachments} attachments\n     * @param {Object} options\n     * @returns {wp.media.model.Attachments} Returns itself to allow chaining\n     */\n    _validateAllHandler: function (attachments, options) {\n        return this.validateAll(attachments, options);\n    },\n\n\n}, {\n    filters: {\n\n        search: function (attachment) {\n            if (!this.props.get('search')) {\n                return true;\n            }\n            return _.any(['description'], function (key) {\n                var value = attachment.get(key);\n                return value && -1 !== value.search(this.props.get('search'));\n            }, this);\n        },\n\n    }\n});\n\nwindow.ShutterpressQuery = ShutterpressImagesModel.extend({\n    /**\n     * @param {array}  [models=[]]  Array of initial models to populate the collection.\n     * @param {object} [options={}]\n     */\n    initialize: function (models, options) {\n        var allowed;\n\n        options = options || {};\n        ShutterpressImagesModel.prototype.initialize.apply(this, arguments);\n\n        this.args = options.args;\n        this._hasMore = true;\n        this.created = new Date();\n\n    },\n\n    /**\n     * Whether there are more attachments that haven't been sync'd from the server\n     * that match the collection's query.\n     *\n     * @returns {boolean}\n     */\n    hasMore: function () {\n        return this._hasMore;\n    },\n    /**\n     * Fetch more attachments from the server for the collection.\n     *\n     * @param   {object}  [options={}]\n     * @returns {Promise}\n     */\n    more: function (options) {\n        var query = this;\n\n        // If there is already a request pending, return early with the Deferred object.\n        if (this._more && 'pending' === this._more.state()) {\n            return this._more;\n        }\n\n        if (!this.hasMore()) {\n            return jQuery.Deferred().resolveWith(this).promise();\n        }\n\n        options = options || {};\n        options.remove = false;\n\n        return this._more = this.fetch(options).done(function (resp) {\n            if (_.isEmpty(resp) || -1 === this.args.per_page || resp.length < this.args.per_page) {\n                query._hasMore = false;\n            }\n        });\n    },\n\n    /**\n     * Overrides Backbone.Collection.sync\n     * Overrides wp.media.model.Attachments.sync\n     *\n     * @param {String} method\n     * @param {Backbone.Model} model\n     * @param {Object} [options={}]\n     * @returns {Promise}\n     */\n    sync: function (method, model, options) {\n        var args, fallback;\n\n        // Overload the read method so Attachment.fetch() functions correctly.\n        if ('read' === method) {\n            options = options || {};\n            options.context = this;\n            options.data = _.extend(options.data || {}, {\n                action: 'query-shutterpress',\n                post_id: wp.media.model.settings.post.id\n            });\n\n            // Clone the args so manipulation is non-destructive.\n            args = _.clone(this.args);\n\n            // Determine which page to query.\n            if (-1 !== args.per_page) {\n                args.page = Math.round(this.length / args.per_page) + 1;\n            }\n\n            options.data.query = args;\n            return wp.media.ajax(options);\n\n            // Otherwise, fall back to Backbone.sync()\n        } else {\n            /**\n             * Call wp.media.model.Attachments.sync or Backbone.sync\n             */\n            fallback = ShutterPressImagesModel.prototype.sync ? ShutterPressImagesModel.prototype : Backbone;\n            return fallback.sync.apply(this, arguments);\n        }\n    }\n}, {\n    /**\n     * @readonly\n     */\n    defaultArgs: {\n        per_page: 40\n    },\n\n    defaultProps: {},\n    /**\n     * A map of JavaScript query properties to their Shutterpress query equivalents.\n     *\n     * @readonly\n     */\n    propmap: {\n        'search': 'query',\n        'perPage': 'per_page',\n    },\n    /**\n     * Creates and returns an Attachments Query collection given the properties.\n     *\n     * Caches query objects and reuses where possible.\n     *\n     * @static\n     * @method\n     *\n     * @param {object} [props]\n     * @param {Object} [options]\n     *\n     * @returns {ShutterpressQuery} A new ShutterpressImagesModel Query collection.\n     */\n    get: (function () {\n        /**\n         * @static\n         * @type Array\n         */\n        var queries = [];\n\n        /**\n         * @returns {Query}\n         */\n        return function (props, options) {\n            var args = {},\n                defaults = ShutterpressQuery.defaults,\n                query,\n                cache = !!props.cache || _.isUndefined(props.cache);\n\n            // Remove the `query` property. This isn't linked to a query,\n            // this *is* the query.\n            delete props.query;\n            delete props.cache;\n\n            // Fill default args.\n            _.defaults(props, defaults);\n\n\n            _.each(['include', 'exclude'], function (prop) {\n                if (props[prop] && !_.isArray(props[prop])) {\n                    props[prop] = [props[prop]];\n                }\n            });\n\n            // Generate the query `args` object.\n            // Correct any differing property names.\n            _.each(props, function (value, prop) {\n                if (_.isNull(value)) {\n                    return;\n                }\n\n                args[ShutterpressQuery.propmap[prop] || prop] = value;\n            });\n\n            // Fill any other default query args.\n            _.defaults(args, ShutterpressQuery.defaultArgs);\n\n            // Search the query cache for a matching query.\n            if (cache) {\n                query = _.find(queries, function (query) {\n                    return _.isEqual(query.args, args);\n                });\n            } else {\n                queries = [];\n            }\n\n            // Otherwise, create a new query and add it to the cache.\n            if (!query) {\n                query = new ShutterpressQuery([], _.extend(options || {}, {\n                    props: props,\n                    args: args\n                }));\n                queries.push(query);\n            }\n\n            return query;\n        };\n    }())\n});\n\nexport default ShutterpressImagesModel;","import ShutterpressRadioFilters from './shutterpress-radio-filter';\n\nvar ShutterpressSafeFilters = ShutterpressRadioFilters.extend(/** @lends wp.media.view.AttachmentFilters.All.prototype */{\n    className: 'advanced-filters safe-filter',\n    id: 'shutterpress-safe-filter',\n    createFilters: function () {\n        var filters = {};\n\n\n        filters.yes = {\n            text: wp.media.view.l10n.shutterpress.filters.safe.yes,\n            props: {\n                safe: true,\n            },\n            name:'safe-search-shutterpress',\n            priority: 20,\n            id: 'shutterpress-safe-yes'\n        };\n\n        filters.no = {\n            text: wp.media.view.l10n.shutterpress.filters.safe.no,\n            props: {\n                safe: false,\n            },\n            priority: 30,\n            name:'safe-search-shutterpress',\n            id: 'shutterpress-safe-no'\n        };\n\n\n        this.filters = filters;\n        this.label = wp.media.view.l10n.shutterpress.filters.safe.label;\n        this.name = 'safe';\n    }\n});\nexport default ShutterpressSafeFilters;","var ShutterpressRadioFilters = wp.media.View.extend(/** @lends wp.media.view.AttachmentFilters.prototype */{\n    className: 'radio-shutterpress-filters',\n\n\n    keys: [],\n    checked: [],\n\n    initialize: function () {\n        this.createFilters();\n        this.createChecked();\n        _.extend(this.filters, this.options.filters);\n        var $mainLabel = $('<span></span>', {'text': this.label, 'class': 'group-label'});\n        // Build `<option>` elements.\n        this.$el.html(_.chain(this.filters).map(function (filter, value) {\n            var $el = $('<input />', {\n                type: 'radio',\n                name: filter.name,\n                value: value,\n                id: filter.id,\n                checked: filter.checked\n            });\n            var t = this;\n            $el.on('change', function (e) {\n                t.radioChange($(this), e)\n            });\n            var $label = $('<label />', {for: filter.id, text: filter.text});\n            var $wrapper = $('<span>', {'class': 'radio-component'}).append($el).append($label);\n            return {\n                el: $wrapper[0],\n                priority: filter.priority || 50\n            };\n        }, this).sortBy('priority').pluck('el').value());\n        this.$el.prepend($mainLabel);\n        this.$el.wrap('<div class=\"' + this.className + '\"></div>');\n        this.controller.on('update-filters', _.bind(this.updateFilters, this));\n        this.radioChange(this.$el);\n    },\n\n    /**\n     * @abstract\n     */\n    createFilters: function () {\n        this.filters = {};\n    },\n\n    /**\n     * @abstract\n     */\n    createChecked: function () {\n        this.checked = [];\n    },\n\n    updateFilters: function () {\n        this.model.set(this.getValue());\n\n    },\n\n    getValue() {\n        if (!this.checked.length) {\n            return null;\n        }\n\n        var filter = this.filters[this.checked];\n        if (filter) {\n            return filter.props\n        }\n    },\n\n    radioChange($element) {\n        this.checked = $element.val();\n    }\n});\n\nexport default ShutterpressRadioFilters;","import ShutterpressColorFilters from './shutterpress-color-picker-filter';\n\nvar ShutterpressColorFilter = ShutterpressColorFilters.extend(/** @lends wp.media.view.AttachmentFilters.All.prototype */{\n    className: 'advanced-filters color-filter',\n    id: 'shutterpress-color-filter',\n    createFilters: function () {\n        var filters = {};\n\n\n        filters.color = {\n            text: wp.media.view.l10n.shutterpress.filters.color.text,\n            props: {\n                color: null,\n            },\n            priority: 20,\n            id: 'shutterpress-color-picker'\n        };\n\n\n        this.filters = filters;\n        this.label = wp.media.view.l10n.shutterpress.filters.color.text;\n        this.name = 'color';\n    }\n});\nexport default ShutterpressColorFilter;","var ShutterpressColorPickerFilter = wp.media.View.extend(/** @lends wp.media.view.AttachmentFilters.prototype */{\n    className: 'color-picker-shutterpress-filters',\n\n\n    keys: [],\n    checked: [],\n\n    initialize: function () {\n        this.createFilters();\n        _.extend(this.filters, this.options.filters);\n        var $mainLabel = $('<span></span>', {'text': this.label, 'class': 'group-label'});\n        // Build `<option>` elements.\n        this.$el.html(_.chain(this.filters).map(function (filter, value) {\n            var $el = $('<input />', {type: 'text', id: filter.id, 'class': 'shutterpress-color-picker'});\n\n            return {\n                el: $el[0],\n                priority: filter.priority || 50\n            };\n        }, this).sortBy('priority').pluck('el').value());\n        this.$el.find('input').wpColorPicker();\n        this.$el.prepend($mainLabel);\n\n        this.$el.wrap('<div class=\"' + this.className + '\"></div>');\n        this.controller.on('update-filters', _.bind(this.change, this));\n    },\n\n    /**\n     * @abstract\n     */\n    createFilters: function () {\n        this.filters = {};\n    },\n\n    /**\n     * When the selected filter changes, update the Attachment Query properties to match.\n     */\n    change: function () {\n        var value = this.getValue();\n        if (!value || value === '') {\n            this.model.set(this.name, null);\n            return this;\n        }\n        this.model.set(this.name, value);\n        return this;\n\n\n    },\n\n    getValue() {\n        return this.$el.find('input').val();\n    }\n});\n\nexport default ShutterpressColorPickerFilter;","var ShutterpressFilterClose = wp.media.View.extend(/** @lends wp.media.view.Search.prototype */{\n    tagName: 'span',\n    className: 'shutterpress-close-filter',\n    defaults: {\n        text: '',\n        disabled: false\n    },\n\n    initialize: function () {\n        /**\n         * Create a model with the provided `defaults`.\n         *\n         * @member {Backbone.Model}\n         */\n        this.model = new Backbone.Model(this.defaults);\n\n        // If any of the `options` have a key from `defaults`, apply its\n        // value to the `model` and remove it from the `options object.\n        _.each(this.defaults, function (def, key) {\n            var value = this.options[key];\n            if (_.isUndefined(value)) {\n                return;\n            }\n\n            this.model.set(key, value);\n            delete this.options[key];\n        }, this);\n\n        this.listenTo(this.model, 'change', this.render);\n    },\n\n    /**\n     * @returns {wp.media.view.Button} Returns itself to allow chaining\n     */\n    render: function () {\n        var classes = [this.className],\n            model = this.model.toJSON();\n\n        classes = _.uniq(classes.concat(this.options.classes));\n        this.el.className = classes.join(' ');\n\n        this.$el.attr('disabled', model.disabled);\n        this.$el.text(this.model.get('text'));\n\n        return this;\n    },\n\n    events: {\n        'click': 'closeAdvanced',\n    },\n\n    closeAdvanced: function () {\n        $('#shutterpress-advanced-filters').toggleClass('visible');\n    }\n});\n\nexport default ShutterpressFilterClose;","import ShutterpressImages from './shutterpress-images'\nimport ShutterpressToolbar from './shutterpress-toolbar'\nimport ShutterpressSearch from './filters/shutterpress-search'\nimport ShutterpressDetails from './shutterpress-details'\nimport ShutterpressSidebar from './shutterpress-sidebar'\nimport ShutterpressEmpty from './shutterpress-empty'\nimport ShutterpressGenderFilter from './filters/shutterpress-gender'\nimport ShutterpressDownloader from './shutterpress-downloader';\nimport ShutterpressAdvancedLink from \"./filters/shutterpress-advanced-trigger\";\nimport ShutterpressAdvancedFilters from \"./filters/shutterpress-advanced-filters\";\nimport ShutterpressAdvanced from \"./filters/shutterpress-advanced\";\nimport ShutterpressFilterButton from \"./filters/shutterpress-filter-button\";\nimport ShutterpressOrientationFilter from \"./filters/shutterpress-orientations\";\nimport ShutterpressImageTypeFilter from \"./filters/shutterpress-image-type\";\nimport ShutterpressCategoryFilters from \"./filters/shutterpress-category\";\nimport ShutterpressSafeFilters from \"./filters/shutterpress-safe\";\nimport ShutterpressColorFilter from \"./filters/shutterpress-color\";\nimport ShutterpressFilterClose from \"./filters/shutterpress-filter-close\";\n\nvar ShutterpressBrowser = wp.media.View.extend(/** @lends wp.media.view.AttachmentsBrowser.prototype */{\n    tagName: 'div',\n    className: 'shutterpress-browser attachments-browser',\n\n    initialize: function () {\n        _.defaults(this.options, {\n            search: true,\n        });\n\n\n        this.createToolbar();\n        this.createSidebar();\n        this.createStatus();\n\n        // Create the list of images.\n        this.createImages();\n\n\n        this.updateContent();\n\n        this.collection.on('add remove reset', this.updateContent, this);\n    },\n\n    /**\n     * @returns {ShutterpressBrowser} Returns itself to allow chaining\n     */\n    dispose: function () {\n        this.options.selection.off(null, null, this);\n        wp.media.View.prototype.dispose.apply(this, arguments);\n        return this;\n    },\n\n    createImages() {\n        this.images = new ShutterpressImages({\n            controller: this.controller,\n            collection: this.collection,\n            selection: this.options.selection,\n            scrollElement: this.options.scrollElement,\n            idealColumnWidth: this.options.idealColumnWidth,\n        });\n\n        this.views.add(this.images);\n        this.images.hide();\n    },\n\n    createSidebar: function () {\n        var options = this.options,\n            selection = options.selection,\n            sidebar = this.sidebar = new ShutterpressSidebar({\n                controller: this.controller\n            });\n\n        this.views.add(sidebar);\n\n\n        selection.on('selection:single', this.createSingle, this);\n        selection.on('selection:unsingle', this.disposeSingle, this);\n\n        if (selection.single()) {\n            this.createSingle();\n        }\n    },\n\n    createSingle: function () {\n        var sidebar = this.sidebar,\n            single = this.options.selection.single();\n\n        sidebar.set('details', new ShutterpressDetails({\n            controller: this.controller,\n            model: single,\n            priority: 80\n        }));\n\n        sidebar.set('downloader', new ShutterpressDownloader({\n            controller: this.controller,\n            model: single,\n            state: this.model,\n            priority: 90\n        }));\n\n        // Show the sidebar on mobile\n        if (this.model.id === 'insert') {\n            sidebar.$el.addClass('visible');\n        }\n    },\n\n    disposeSingle: function () {\n        var sidebar = this.sidebar;\n        sidebar.unset('details');\n        sidebar.unset('downloader');\n        // Hide the sidebar on mobile\n        sidebar.$el.removeClass('visible');\n    },\n\n    updateContent: function () {\n        var view = this,\n            noItemsView;\n\n        noItemsView = view.status;\n\n        noItemsView.hide();\n        if (!this.collection.length) {\n            this.startLoading();\n            this.clearErrors();\n            this.dfd = this.collection.more().done(function () {\n                if (!view.collection.length) {\n                    noItemsView.show()\n                } else {\n                    noItemsView.hide()\n                }\n                view.stopLoading()\n            }).fail(\n                function (message) {\n                    noItemsView.show();\n                    view.displayError(message);\n\n                    view.stopLoading();\n                }\n            );\n        } else {\n            view.images.show();\n            noItemsView.hide();\n            this.stopLoading();\n        }\n    },\n\n    createToolbar: function () {\n        var toolbarOptions;\n\n        toolbarOptions = {\n            controller: this.controller,\n        };\n\n        if (this.controller.isModeActive('grid')) {\n            toolbarOptions.className = 'media-toolbar wp-filter';\n        }\n\n        /**\n         * @member {ShutterpressToolbar}\n         */\n        this.toolbar = new ShutterpressToolbar(toolbarOptions);\n\n        this.views.add(this.toolbar);\n\n        this.advancedFilters = new ShutterpressAdvanced({\n            controller: this.controller,\n            priority: 50\n        });\n        this.toolbar.set('advanced-filters', this.advancedFilters);\n\n        this.toolbar.set('spinner', new wp.media.view.Spinner({\n            priority: -60\n        }));\n        this.addToolbarFilters();\n\n    },\n\n    addToolbarFilters() {\n\n        // Search is an input, screen reader text needs to be rendered before\n        this.toolbar.set('searchLabel', new wp.media.view.Label({\n            value: wp.media.view.l10n.shutterpress.search,\n            attributes: {\n                'for': 'media-search-input'\n            },\n            priority: 60\n        }).render());\n        this.toolbar.set('search', new ShutterpressSearch({\n            controller: this.controller,\n            model: this.collection.props,\n            priority: 60\n        }).render());\n\n        this.advancedFilters.set('advanced-link', new ShutterpressAdvancedLink({\n            controller: this.controller,\n            model: this.collection.props,\n            text: wp.media.view.l10n.shutterpress.advanced,\n            priority: -10\n        }).render());\n\n        this.filtersContainer = new ShutterpressAdvancedFilters({\n            controller: this.controller,\n            model: this.collection.props,\n            priority: 10\n        });\n        this.advancedFilters.set('filters-container', this.filtersContainer).render();\n\n        var ImageTypeFilter = new ShutterpressImageTypeFilter({\n            controller: this.controller,\n            model: this.collection.props,\n            priority: -100\n        });\n        this.filtersContainer.set('image-type-filter', ImageTypeFilter.render());\n\n        var CategoryFilter = new ShutterpressCategoryFilters({\n            controller: this.controller,\n            model: this.collection.props,\n            priority: -95\n        });\n        this.filtersContainer.set('category-filter', CategoryFilter.render());\n\n        var GenderFilters = new ShutterpressGenderFilter({\n            controller: this.controller,\n            model: this.collection.props,\n            priority: -90\n        });\n        this.filtersContainer.set('gender-filter', GenderFilters.render());\n\n        var SafeFilter = new ShutterpressSafeFilters({\n            controller: this.controller,\n            model: this.collection.props,\n            priority: -85\n        });\n        this.filtersContainer.set('safe-filter', SafeFilter.render());\n\n        var OrientationFilter = new ShutterpressOrientationFilter({\n            controller: this.controller,\n            model: this.collection.props,\n            priority: -80\n        });\n        this.filtersContainer.set('orientation-filter', OrientationFilter.render());\n\n        var ColorFilter = new ShutterpressColorFilter({\n            controller: this.controller,\n            model: this.collection.props,\n            priority: -70\n        });\n        this.filtersContainer.set('color-filter', ColorFilter.render());\n\n\n        this.filtersContainer.set('update-filter', new ShutterpressFilterButton({\n            controller: this.controller,\n            model: this.collection.props,\n            priority: 20,\n            text: wp.media.view.l10n.shutterpress.search,\n        }));\n\n        this.filtersContainer.set('close-advanced-filter', new ShutterpressFilterClose({\n            controller: this.controller,\n            model: this.collection.props,\n            priority: 10,\n            text: ' ',\n        }));\n    },\n\n    createStatus: function () {\n        var statusOptions;\n\n        statusOptions = {\n            controller: this.controller,\n            message: wp.media.view.l10n.shutterpress.noMedia,\n            retry: wp.media.view.l10n.shutterpress.retry,\n            browser: this\n        };\n\n        if (this.controller.isModeActive('grid')) {\n            statusOptions.className = 'media-toolbar wp-filter';\n        }\n\n        /**\n         * @member {wp.media.view.Toolbar}\n         */\n        this.status = new ShutterpressEmpty(statusOptions);\n\n        this.status.hide();\n\n        this.views.add(this.status);\n\n    },\n\n    displayError(error) {\n        this.images.hide();\n        this.status.model.set('message', wp.media.view.l10n.shutterpress.error);\n        this.status.model.set('error', error.message);\n        if (error.code === 2) {\n            this.status.model.set('link', {\n                url: wp.media.view.l10n.shutterpress.url,\n                text: wp.media.view.l10n.shutterpress.link,\n            });\n        }\n    },\n\n    clearErrors() {\n        this.status.model.set('message', wp.media.view.l10n.shutterpress.noMedia);\n        this.status.model.set('error', '');\n    },\n\n    stopLoading() {\n        this.toolbar.get('spinner').hide();\n    },\n    startLoading() {\n        this.toolbar.get('spinner').show();\n    }\n\n});\n\nexport default ShutterpressBrowser;\n","import ShutterpressImagesModel from './shutterpress-images-model';\n\n\nvar ShutterpressSelection = ShutterpressImagesModel.extend({\n    /**\n     * Refresh the `single` model whenever the selection changes.\n     * Binds `single` instead of using the context argument to ensure\n     * it receives no parameters.\n     *\n     * @param {Array} [models=[]] Array of models used to populate the collection.\n     * @param {Object} [options={}]\n     */\n    initialize: function (models, options) {\n        /**\n         * call 'initialize' directly on the parent class\n         */\n        ShutterpressImagesModel.prototype.initialize.apply(this, arguments);\n        this.multiple = options && options.multiple;\n\n        this.on('add remove reset', _.bind(this.single, this, false));\n    },\n\n    /**\n     * If the workflow does not support multi-select, clear out the selection\n     * before adding a new attachment to it.\n     *\n     * @param {Array} models\n     * @param {Object} options\n     * @returns {ShutterPressImagesModel[]}\n     */\n    add: function (models, options) {\n        if (!this.multiple) {\n            this.remove(this.models);\n        }\n        /**\n         * call 'add' directly on the parent class\n         */\n        return ShutterpressImagesModel.prototype.add.call(this, models, options);\n    },\n\n    /**\n     * Fired when toggling (clicking on) an attachment in the modal.\n     *\n     * @param {undefined|boolean|ShutterPressImagesModel} model\n     *\n     * @fires ShutterpressSelection#selection:single\n     * @fires ShutterpressSelection#selection:unsingle\n     *\n     * @returns {Backbone.Model}\n     */\n    single: function (model) {\n        var previous = this._single;\n\n        // If a `model` is provided, use it as the single model.\n        if (model) {\n            this._single = model;\n        }\n        // If the single model isn't in the selection, remove it.\n        if (this._single && !this.get(this._single.cid)) {\n            delete this._single;\n        }\n\n        this._single = this._single || this.last();\n\n        // If single has changed, fire an event.\n        if (this._single !== previous) {\n            if (previous) {\n                previous.trigger('selection:unsingle', previous, this);\n\n                // If the model was already removed, trigger the collection\n                // event manually.\n                if (!this.get(previous.cid)) {\n                    this.trigger('selection:unsingle', previous, this);\n                }\n            }\n            if (this._single) {\n                this._single.trigger('selection:single', this._single, this);\n            }\n        }\n\n        // Return the single model, or the last model as a fallback.\n        return this._single;\n    }\n});\n\n\nexport default ShutterpressSelection;","import ShutterpressImagesModel from './models/shutterpress-images-model';\n\nwindow.getShutterPressQuery = function (props) {\n    return new ShutterpressImagesModel(null, {\n        props: _.extend(_.defaults(props || {}, {orderby: 'date'}), {query: true})\n    });\n};","import ShutterpressBrowser from './shutterpress-browser'\nimport ShutterpressImages from './models/shutterpress-images-model'\nimport ShutterpressSelection from './models/shutterpress-selection-model'\nimport './shutterpress-helpers'\n\nvar oldLibrary = wp.media.controller.Library;\nvar oldMediaFrame = wp.media.view.MediaFrame.Post;\nvar oldMediaFrameSelect = wp.media.view.MediaFrame.Select;\n\nwindow.ShutterpressQueue = new ShutterpressImages([], {query: false});\nwindow.ShutterpressQueueErrors = new Backbone.Collection();\n\n\n// Extending the current media library frame to add a new tab\nwp.media.view.MediaFrame.Post = oldMediaFrame.extend({\n\n    /**\n     * overwrite router to\n     *\n     * @param {wp.media.view.Router} routerView\n     */\n    browseRouter: function (routerView) {\n        oldMediaFrame.prototype.browseRouter.apply(this, arguments);\n        routerView.set({\n            shutterpress: {\n                text: wp.media.view.l10n.shutterpress.title,\n                priority: 60\n            }\n        });\n    },\n\n    /**\n     * Bind region mode event callbacks.\n     *\n     * @see media.controller.Region.render\n     */\n    bindHandlers: function () {\n        oldMediaFrame.prototype.bindHandlers.apply(this, arguments);\n        this.on('content:create:shutterpress', this.shutterpressContent, this);\n    },\n\n    /**\n     * Render callback for the content region in the `browse` mode.\n     *\n     * @param {wp.media.controller.Region} contentRegion\n     */\n    shutterpressContent: function (contentRegion) {\n        var state = this.state();\n        if (!state.get('shutterpress-images')) {\n            state.set('shutterpress-images', getShutterPressQuery());\n            // Watch for downloaded images.\n            state.get('library').observe(ShutterpressQueue);\n        }\n\n        if (!state.get('shutterpress-selection')) {\n            var props;\n            props = state.get('shutterpress-images').props.toJSON();\n            props = _.omit(props, 'orderby', 'query');\n\n\n            state.set('shutterpress-selection', new ShutterpressSelection(null, {\n                multiple: false,\n                props: props\n            }));\n        }\n\n        this.$el.removeClass('hide-toolbar');\n\n        // Browse our library of attachments.\n        contentRegion.view = new ShutterpressBrowser({\n            collection: state.get('shutterpress-images'),\n            selection: state.get('shutterpress-selection'),\n            controller: this,\n            model: state,\n            idealColumnWidth: state.get('idealColumnWidth'),\n            suggestedWidth: state.get('suggestedWidth'),\n            suggestedHeight: state.get('suggestedHeight'),\n        });\n    },\n\n    getFrame(id) {\n        return this.states.findWhere({id: id});\n    }\n\n\n});\n\n\n// Order is important, post is based on the old select\nwp.media.view.MediaFrame.Select = oldMediaFrameSelect.extend({\n\n    /**\n     * overwrite router to\n     *\n     * @param {wp.media.view.Router} routerView\n     */\n    browseRouter: function (routerView) {\n        oldMediaFrameSelect.prototype.browseRouter.apply(this, arguments);\n        routerView.set({\n            shutterpress: {\n                text: wp.media.view.l10n.shutterpress.title,\n                priority: 60\n            }\n        });\n    },\n\n    /**\n     * Bind region mode event callbacks.\n     *\n     * @see media.controller.Region.render\n     */\n    bindHandlers: function () {\n        oldMediaFrameSelect.prototype.bindHandlers.apply(this, arguments);\n        this.on('content:create:shutterpress', this.shutterpressContent, this);\n    },\n\n    /**\n     * Render callback for the content region in the `browse` mode.\n     *\n     * @param {wp.media.controller.Region} contentRegion\n     */\n    shutterpressContent: function (contentRegion) {\n        var state = this.state();\n        if (!state.get('shutterpress-images')) {\n            state.set('shutterpress-images', getShutterPressQuery());\n            // Watch for downloaded images.\n            state.get('library').observe(ShutterpressQueue);\n        }\n\n        if (!state.get('shutterpress-selection')) {\n            var props;\n            props = state.get('shutterpress-images').props.toJSON();\n            props = _.omit(props, 'orderby', 'query');\n\n\n            state.set('shutterpress-selection', new ShutterpressSelection(null, {\n                multiple: false,\n                props: props\n            }));\n        }\n\n        this.$el.removeClass('hide-toolbar');\n\n        // Browse our library of attachments.\n        contentRegion.view = new ShutterpressBrowser({\n            collection: state.get('shutterpress-images'),\n            selection: state.get('shutterpress-selection'),\n            controller: this,\n            model: state,\n            idealColumnWidth: state.get('idealColumnWidth'),\n            suggestedWidth: state.get('suggestedWidth'),\n            suggestedHeight: state.get('suggestedHeight'),\n        });\n    },\n\n    getFrame(id) {\n        return this.states.findWhere({id: id});\n    }\n\n\n});\n\n\n"],"sourceRoot":""}